{% extends "dashboards/base_dashboard.html" %}

{% block title %}System Settings - {{ school_settings.school_name or 'Modern School' }}{% endblock %}


{% block role_primary %}#10b981{% endblock %}
{% block role_secondary %}#059669{% endblock %}
{% block role_accent %}#047857{% endblock %}
{% block role_gradient_start %}#10b981{% endblock %}
{% block role_gradient_end %}#047857{% endblock %}

{% block sidebar_content %}
{% if session.get('role', '').lower() == 'technician' %}
<a href="/role-switch" 
   class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 mb-3 border-b border-gray-700/50 pb-3">
    <i class="fas fa-exchange-alt w-5"></i>
    <span>Role Switch</span>
</a>

<a href="/system-settings" 
   class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg transition-all text-white bg-gray-700/50 border-l-4 mb-4"
   style="border-color: var(--role-primary);">
    <i class="fas fa-cog w-5"></i>
    <span>System Settings</span>
    <i class="fas fa-check-circle ml-auto text-green-500"></i>
</a>

<!-- A. Basic Settings -->
<div class="mb-4 pb-3 border-b border-gray-700/30">
    <div class="px-4 py-2 mb-2 bg-gradient-to-r from-blue-600/20 to-blue-500/10 rounded-lg border-l-4 border-blue-500">
        <div class="flex items-center space-x-2">
            <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                <span class="text-white text-xs font-bold">A</span>
            </div>
            <p class="text-xs font-bold text-blue-300 uppercase tracking-wider">Basic Settings</p>
        </div>
    </div>
    <div class="ml-2 space-y-1">
        <a @click.prevent="activeSection = 'school-profile'; loadSection('school-profile')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'school-profile'}"
           :style="activeSection === 'school-profile' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-school w-4"></i>
            <span>School Profile</span>
        </a>
        <a @click.prevent="activeSection = 'general-settings'; loadSection('general-settings')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'general-settings'}"
           :style="activeSection === 'general-settings' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-sliders-h w-4"></i>
            <span>General Settings</span>
        </a>
        <a @click.prevent="activeSection = 'academic-year'; loadSection('academic-year')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'academic-year'}"
           :style="activeSection === 'academic-year' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-calendar-alt w-4"></i>
            <span>Academic Year & Terms</span>
        </a>
    </div>
</div>

<!-- B. Appearance -->
<div class="mb-4 pb-3 border-b border-gray-700/30">
    <div class="px-4 py-2 mb-2 bg-gradient-to-r from-purple-600/20 to-purple-500/10 rounded-lg border-l-4 border-purple-500">
        <div class="flex items-center space-x-2">
            <div class="w-6 h-6 bg-purple-500 rounded-full flex items-center justify-center">
                <span class="text-white text-xs font-bold">B</span>
            </div>
            <p class="text-xs font-bold text-purple-300 uppercase tracking-wider">Appearance</p>
        </div>
    </div>
    <div class="ml-2 space-y-1">
        <a @click.prevent="activeSection = 'theme-colors'; loadSection('theme-colors')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'theme-colors'}"
           :style="activeSection === 'theme-colors' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-palette w-4"></i>
            <span>Theme / Colors</span>
        </a>
        <a @click.prevent="activeSection = 'login-settings'; loadSection('login-settings')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'login-settings'}"
           :style="activeSection === 'login-settings' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-sign-in-alt w-4"></i>
            <span>Login Page Settings</span>
        </a>
    </div>
</div>

<!-- C. Communication -->
<div class="mb-4 pb-3 border-b border-gray-700/30">
    <div class="px-4 py-2 mb-2 bg-gradient-to-r from-green-600/20 to-green-500/10 rounded-lg border-l-4 border-green-500">
        <div class="flex items-center space-x-2">
            <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                <span class="text-white text-xs font-bold">C</span>
            </div>
            <p class="text-xs font-bold text-green-300 uppercase tracking-wider">Communication</p>
        </div>
    </div>
    <div class="ml-2 space-y-1">
        <a @click.prevent="activeSection = 'email-settings'; loadSection('email-settings')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'email-settings'}"
           :style="activeSection === 'email-settings' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-envelope w-4"></i>
            <span>Email (SMTP) Settings</span>
        </a>
        <a @click.prevent="activeSection = 'sms-settings'; loadSection('sms-settings')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'sms-settings'}"
           :style="activeSection === 'sms-settings' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-sms w-4"></i>
            <span>SMS Settings</span>
        </a>
        <a @click.prevent="activeSection = 'notification-templates'; loadSection('notification-templates')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'notification-templates'}"
           :style="activeSection === 'notification-templates' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-bell w-4"></i>
            <span>Notification Templates</span>
        </a>
    </div>
</div>

<!-- D. System Controls -->
<div class="mb-4 pb-3 border-b border-gray-700/30">
    <div class="px-4 py-2 mb-2 bg-gradient-to-r from-orange-600/20 to-orange-500/10 rounded-lg border-l-4 border-orange-500">
        <div class="flex items-center space-x-2">
            <div class="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center">
                <span class="text-white text-xs font-bold">D</span>
            </div>
            <p class="text-xs font-bold text-orange-300 uppercase tracking-wider">System Controls</p>
        </div>
    </div>
    <div class="ml-2 space-y-1">
        <a @click.prevent="activeSection = 'backup-restore'; loadSection('backup-restore')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'backup-restore'}"
           :style="activeSection === 'backup-restore' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-database w-4"></i>
            <span>Backup & Restore</span>
        </a>
        <a @click.prevent="activeSection = 'language-timezone'; loadSection('language-timezone')" 
           class="sidebar-item flex items-center space-x-3 px-4 py-2.5 rounded-lg transition-all text-gray-300 hover:text-white hover:bg-gray-700/50 text-sm"
           :class="{'text-white bg-gray-700/50 border-l-2': activeSection === 'language-timezone'}"
           :style="activeSection === 'language-timezone' ? 'border-color: var(--role-primary);' : ''">
            <i class="fas fa-globe w-4"></i>
            <span>Language & Timezone</span>
        </a>
    </div>
</div>

{% else %}
<p class="text-gray-400 text-sm px-4 py-2">Menu items will be added here</p>
{% endif %}
{% endblock %}

{% block content %}
<style>
    /* Modern Animations for Icons */
    @keyframes iconPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }
    
    @keyframes iconFloat {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
    }
    
    @keyframes iconRotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    @keyframes iconBounce {
        0%, 100% { transform: translateY(0); }
        25% { transform: translateY(-8px); }
        75% { transform: translateY(-4px); }
    }
    
    @keyframes shimmer {
        0% { background-position: -1000px 0; }
        100% { background-position: 1000px 0; }
    }
    
    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fadeInScale {
        from {
            opacity: 0;
            transform: scale(0.95);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
    
    @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }
    
    /* Animated Icons */
    .icon-animated {
        animation: iconFloat 3s ease-in-out infinite;
    }
    
    .icon-pulse {
        animation: iconPulse 2s ease-in-out infinite;
    }
    
    .icon-rotate:hover {
        animation: iconRotate 1s linear;
    }
    
    .icon-bounce:hover {
        animation: iconBounce 0.6s ease;
    }
    
    /* Modern Card Styles */
    .modern-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        backdrop-filter: blur(10px);
        animation: slideInUp 0.6s ease-out;
    }
    
    .modern-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }
    
    .modern-card:nth-child(1) { animation-delay: 0.1s; }
    .modern-card:nth-child(2) { animation-delay: 0.2s; }
    .modern-card:nth-child(3) { animation-delay: 0.3s; }
    .modern-card:nth-child(4) { animation-delay: 0.4s; }
    
    /* Gradient Background Animation */
    .gradient-animated {
        background-size: 200% 200%;
        animation: gradientShift 8s ease infinite;
    }
    
    /* Modern Button Styles */
    .btn-modern {
        position: relative;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .btn-modern::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }
    
    .btn-modern:hover::before {
        width: 300px;
        height: 300px;
    }
    
    .btn-modern:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    
    .btn-modern:active {
        transform: translateY(0) scale(0.98);
    }
    
    /* Status Badge Animations */
    .badge-modern {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .badge-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }
    
    .badge-modern:hover::before {
        left: 100%;
    }
    
    /* Action Button Styles */
    .action-btn {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }
    
    .action-btn:hover {
        transform: scale(1.1) rotate(5deg);
    }
    
    .action-btn:active {
        transform: scale(0.95);
    }
    
    /* Current Year Card Special Animation */
    .current-year-card {
        animation: fadeInScale 0.8s ease-out;
        position: relative;
        overflow: hidden;
    }
    
    .current-year-card::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        animation: shimmer 3s infinite;
    }
    
    /* Responsive Design */
    @media (max-width: 640px) {
        .modern-card {
            margin-bottom: 1rem;
        }
        
        .modern-card:hover {
            transform: translateY(-4px) scale(1.01);
        }
        
        .btn-modern {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
        }
        
        .action-btn {
            padding: 0.5rem;
            min-width: 44px;
            min-height: 44px;
        }
    }
    
    @media (min-width: 641px) and (max-width: 1024px) {
        .modern-card {
            margin-bottom: 1.5rem;
        }
    }
    
    /* Loading Animation */
    .loading-spinner {
        animation: iconRotate 1s linear infinite;
    }
    
    /* Icon Hover Effects */
    .icon-hover-effect:hover i {
        animation: iconBounce 0.6s ease;
    }
    
    /* Smooth Transitions */
    * {
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Custom Scrollbar Styling */
    .scrollbar-thin {
        scrollbar-width: thin;
        scrollbar-color: rgb(147, 51, 234) rgb(229, 231, 235);
    }
    
    .scrollbar-thin::-webkit-scrollbar {
        width: 8px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-track {
        background: rgb(229, 231, 235);
        border-radius: 4px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb {
        background: rgb(147, 51, 234);
        border-radius: 4px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
        background: rgb(126, 34, 206);
    }
    
    .dark .scrollbar-thin {
        scrollbar-color: rgb(147, 51, 234) rgb(55, 65, 81);
    }
    
    .dark .scrollbar-thin::-webkit-scrollbar-track {
        background: rgb(55, 65, 81);
    }
    
    /* Checkbox Styling for Academic Levels - Simple List Format */
    .academic-level-checkbox:checked {
        background-color: rgb(147, 51, 234) !important; /* purple-600 */
        border-color: rgb(147, 51, 234) !important;
    }
    
    /* Checked state styling - using JavaScript will add 'checked-label' class */
    label.checked-label {
        background-color: rgba(147, 51, 234, 0.1) !important;
    }
    
    label.checked-label .level-name {
        color: rgb(147, 51, 234) !important;
        font-weight: 600;
    }
    
    /* Slide in animation for notifications */
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(100%);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    .animate-slideIn {
        animation: slideIn 0.3s ease-out;
    }
</style>
<div class="container mx-auto px-3 sm:px-4 md:px-6 py-6 sm:py-8 max-w-7xl" x-data="systemSettings()">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">System Settings</h1>
        <p class="text-gray-600 dark:text-gray-400">Manage system configuration and settings</p>
    </div>

    <!-- Content Area -->
    <div id="settings-content" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 min-h-[400px]">
        <div x-show="!activeSection" class="text-center py-16">
            <div class="w-24 h-24 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-xl">
                <i class="fas fa-cog text-white text-4xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">System Settings</h2>
            <p class="text-gray-600 dark:text-gray-400">Select a setting category from the sidebar to get started</p>
        </div>

        <!-- School Profile -->
        <div x-show="activeSection === 'school-profile'" x-cloak style="display: none;">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-school text-green-600 mr-3"></i>
                School Profile
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Configure your school's basic information and profile details.</p>
            
            <form action="/system-settings/school-profile" method="POST" enctype="multipart/form-data" class="space-y-6">
                <!-- School Logo -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700">
                    <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">
                        <i class="fas fa-image text-green-600 mr-2"></i>
                        School Logo <span class="text-gray-400 text-xs font-normal">(Optional)</span>
                    </label>
                    <div class="flex items-start space-x-6">
                        <div class="flex-shrink-0" id="logo-preview-container">
                            {% if school_data and school_data.get('school_logo') %}
                            <img id="current-logo" 
                                 src="{{ url_for('static', filename=school_data.school_logo) }}" 
                                 alt="School Logo" 
                                 class="w-32 h-32 object-cover rounded-lg border-2 border-gray-200 dark:border-gray-700 shadow-md">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">Current Logo</p>
                            {% else %}
                            <div id="logo-placeholder" class="w-32 h-32 bg-gray-100 dark:bg-gray-700 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 flex items-center justify-center">
                                <i class="fas fa-image text-gray-400 text-3xl"></i>
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center hidden" id="logo-preview-label">New Logo Preview</p>
                            {% endif %}
                        </div>
                        <div class="flex-1">
                            <input type="file" 
                                   id="school_logo_input"
                                   name="school_logo" 
                                   accept="image/*"
                                   class="w-full px-4 py-2.5 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                                {% if school_data and school_data.get('school_logo') %}
                                Upload a new logo to replace the current one (PNG, JPG, JPEG, GIF - Max 5MB)
                                {% else %}
                                Upload school logo (PNG, JPG, JPEG, GIF - Max 5MB)
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- School Name -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700">
                    <label for="school_name" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-school text-green-600 mr-2"></i>
                        School Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" 
                           id="school_name" 
                           name="school_name" 
                           value="{% if school_data %}{{ school_data.get('school_name', '') }}{% endif %}"
                           required
                           class="school-profile-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                </div>

                <!-- School Email -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700">
                    <label for="school_email" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-envelope text-green-600 mr-2"></i>
                        School Email
                    </label>
                    <input type="email" 
                           id="school_email" 
                           name="school_email" 
                           value="{% if school_data %}{{ school_data.get('school_email', '') }}{% endif %}"
                           class="school-profile-lowercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                </div>

                <!-- School Phone -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700">
                    <label for="school_phone" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-phone text-green-600 mr-2"></i>
                        School Phone
                    </label>
                    <input type="tel" 
                           id="school_phone" 
                           name="school_phone" 
                           value="{% if school_data %}{{ school_data.get('school_phone', '') }}{% endif %}"
                           class="school-profile-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                </div>

                <!-- Social Media Accounts -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-share-alt text-green-600 mr-2"></i>
                        Social Media Accounts
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="twitter_url" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fab fa-twitter text-blue-400 mr-2"></i>
                                Twitter
                            </label>
                            <input type="url" 
                                   id="twitter_url" 
                                   name="twitter_url" 
                                   value="{% if school_data %}{{ school_data.get('twitter_url', '') }}{% endif %}"
                                   placeholder="https://twitter.com/yourhandle"
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400 dark:hover:border-green-500">
                        </div>
                        <div>
                            <label for="facebook_url" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fab fa-facebook text-blue-600 mr-2"></i>
                                Facebook
                            </label>
                            <input type="url" 
                                   id="facebook_url" 
                                   name="facebook_url" 
                                   value="{% if school_data %}{{ school_data.get('facebook_url', '') }}{% endif %}"
                                   placeholder="https://facebook.com/yourpage"
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400 dark:hover:border-green-500">
                        </div>
                        <div>
                            <label for="instagram_url" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fab fa-instagram text-pink-500 mr-2"></i>
                                Instagram
                            </label>
                            <input type="url" 
                                   id="instagram_url" 
                                   name="instagram_url" 
                                   value="{% if school_data %}{{ school_data.get('instagram_url', '') }}{% endif %}"
                                   placeholder="https://instagram.com/yourhandle"
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400 dark:hover:border-green-500">
                        </div>
                        <div>
                            <label for="tiktok_url" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fab fa-tiktok text-black dark:text-white mr-2"></i>
                                TikTok
                            </label>
                            <input type="url" 
                                   id="tiktok_url" 
                                   name="tiktok_url" 
                                   value="{% if school_data %}{{ school_data.get('tiktok_url', '') }}{% endif %}"
                                   placeholder="https://tiktok.com/@yourhandle"
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400 dark:hover:border-green-500">
                        </div>
                        <div>
                            <label for="whatsapp_number" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fab fa-whatsapp text-green-500 mr-2"></i>
                                WhatsApp Number
                            </label>
                            <input type="tel" 
                                   id="whatsapp_number" 
                                   name="whatsapp_number" 
                                   value="{% if school_data %}{{ school_data.get('whatsapp_number', '') }}{% endif %}"
                                   placeholder="+254712345678"
                                   class="school-profile-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                        </div>
                    </div>
                </div>

                <!-- School Location -->
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-gray-200 dark:border-gray-700">
                    <label for="school_location" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                        <i class="fas fa-map-marker-alt text-green-600 mr-2"></i>
                        School Location
                    </label>
                    <textarea id="school_location" 
                              name="school_location" 
                              rows="3"
                              class="school-profile-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all resize-none">{% if school_data %}{{ school_data.get('school_location', '') }}{% endif %}</textarea>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" 
                            @click="activeSection = null"
                            class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all duration-300">
                        <i class="fas fa-save mr-2"></i>
                        Save Changes
                    </button>
                </div>
            </form>
        </div>

        <!-- General Settings -->
        <div x-show="activeSection === 'general-settings'" x-cloak style="display: none;">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-sliders-h text-green-600 mr-3"></i>
                General Settings
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Manage general system settings and preferences.</p>
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <p class="text-sm text-gray-500 dark:text-gray-400">General Settings will be displayed here</p>
                </div>
            </div>
        </div>

        <!-- Academic Year & Terms -->
        <div x-show="activeSection === 'academic-year'" x-cloak style="display: none;" x-data="{ activeSubSection: 'academic-level' }">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-calendar-alt text-green-600 mr-3"></i>
                Academic Year & Terms
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Configure academic levels, years, and terms for your institution.</p>
            
            <!-- Sub-section Navigation Tabs -->
            <div class="mb-6 border-b border-gray-200 dark:border-gray-700">
                <nav class="flex space-x-1" aria-label="Tabs">
                    <button @click="activeSubSection = 'academic-level'"
                            :class="activeSubSection === 'academic-level' ? 'border-green-500 text-green-600 dark:text-green-400' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'"
                            class="whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm transition-all duration-200 flex items-center space-x-2">
                        <i class="fas fa-layer-group"></i>
                        <span>Academic Levels</span>
                    </button>
                    <button @click="activeSubSection = 'academic-year'"
                            :class="activeSubSection === 'academic-year' ? 'border-green-500 text-green-600 dark:text-green-400' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'"
                            class="whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm transition-all duration-200 flex items-center space-x-2">
                        <i class="fas fa-calendar-check"></i>
                        <span>Academic Years</span>
                    </button>
                    <button @click="activeSubSection = 'term-settings'"
                            :class="activeSubSection === 'term-settings' ? 'border-green-500 text-green-600 dark:text-green-400' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'"
                            class="whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm transition-all duration-200 flex items-center space-x-2">
                        <i class="fas fa-calendar-week"></i>
                        <span>Term Settings</span>
                    </button>
                </nav>
            </div>

            <!-- Academic Level Registration Section -->
            <div x-show="activeSubSection === 'academic-level'" x-cloak style="display: none;">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-6 border border-blue-200 dark:border-blue-800">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 flex items-center">
                        <i class="fas fa-layer-group text-blue-600 dark:text-blue-400 mr-3"></i>
                        Academic Level Registration
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm">Register and manage academic levels (e.g., Primary, Secondary, etc.)</p>
                </div>

                <!-- Add New Academic Level Form -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6 mb-6">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-plus-circle text-green-600 mr-2"></i>
                        Add New Academic Level
                    </h4>
                    <form action="/system-settings/academic-level" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-4" id="academic-level-form">
                        <div>
                            <label for="level_category" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Level Category <span class="text-red-500">*</span>
                            </label>
                            <input type="text" 
                                   id="level_category" 
                                   name="level_category" 
                                   placeholder="E.G., PRIMARY, SECONDARY, PRE-PRIMARY"
                                   required
                                   class="academic-level-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        </div>
                        <div>
                            <label for="level_name" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Level Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text" 
                                   id="level_name" 
                                   name="level_name" 
                                   placeholder="E.G., PRIMARY, SECONDARY, PRE-PRIMARY"
                                   required
                                   class="academic-level-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        </div>
                        <div class="md:col-span-2">
                            <label for="level_description" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Level Description
                            </label>
                            <textarea id="level_description" 
                                      name="level_description" 
                                      rows="3"
                                      placeholder="BRIEF DESCRIPTION OF THIS ACADEMIC LEVEL"
                                      class="academic-level-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-gray-200 dark:border-gray-600">
                                <div class="flex items-center space-x-3">
                                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">
                                        <i class="fas fa-toggle-on text-blue-600 mr-2"></i>
                                        Level Status
                                    </span>
                                    <span id="status-label" class="text-sm font-medium text-green-600 dark:text-green-400">Active</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" 
                                           id="level_status" 
                                           name="level_status" 
                                           checked
                                           class="sr-only peer">
                                    <input type="hidden" 
                                           id="level_status_value" 
                                           name="level_status_value" 
                                           value="active">
                                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                </label>
                            </label>
                        </div>
                        <div class="md:col-span-2 flex justify-end space-x-3">
                            <button type="button" 
                                    class="px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                                Cancel
                            </button>
                            <button type="submit" 
                                    class="px-6 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all duration-300">
                                <i class="fas fa-save mr-2"></i>
                                Add Level
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Academic Levels List -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center justify-between">
                        <span class="flex items-center">
                            <i class="fas fa-list text-blue-600 mr-2"></i>
                            Registered Academic Levels
                        </span>
                        {% if academic_levels and academic_levels|length > 0 %}
                        <span class="text-sm font-normal text-gray-500 dark:text-gray-400">
                            ({{ academic_levels|length }} level{{ 's' if academic_levels|length != 1 else '' }})
                        </span>
                        {% endif %}
                    </h4>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Level Category</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Level Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Description</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                {% if academic_levels and academic_levels|length > 0 %}
                                    {% for level in academic_levels %}
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 dark:text-white">
                                                {{ level.level_category }}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900 dark:text-white">
                                                {{ level.level_name }}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="text-sm text-gray-500 dark:text-gray-400 max-w-xs truncate" title="{{ level.level_description }}">
                                                {{ level.level_description or 'N/A' }}
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-center">
                                            <div class="flex items-center justify-center space-x-2">
                                                <span id="status-label-{{ level.id }}" class="text-xs font-medium {% if level.level_status == 'active' %}text-green-600 dark:text-green-400{% else %}text-gray-500 dark:text-gray-400{% endif %}">
                                                    {% if level.level_status == 'active' %}Active{% else %}Inactive{% endif %}
                                                </span>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" 
                                                           class="sr-only peer status-toggle" 
                                                           data-level-id="{{ level.id }}"
                                                           {% if level.level_status == 'active' %}checked{% endif %}>
                                                    <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
                                                </label>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <div class="flex items-center justify-end space-x-2">
                                                <button type="button" 
                                                        class="edit-level-btn text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 transition-colors p-2 rounded-lg hover:bg-blue-50 dark:hover:bg-blue-900/20"
                                                        title="Edit"
                                                        data-level-id="{{ level.id }}"
                                                        data-level-category="{{ level.level_category }}"
                                                        data-level-name="{{ level.level_name }}"
                                                        data-level-description="{{ level.level_description or '' }}"
                                                        data-level-status="{{ level.level_status }}">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button type="button" 
                                                        class="delete-level-btn text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 transition-colors p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20"
                                                        title="Delete"
                                                        data-level-id="{{ level.id }}"
                                                        data-level-name="{{ level.level_name }}">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="5" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                            <i class="fas fa-inbox text-4xl mb-3 opacity-50"></i>
                                            <p>No academic levels registered yet</p>
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Edit Academic Level Modal -->
                <div id="editLevelModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-3 sm:p-4 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto" @click.stop>
                        <!-- Modal Header -->
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 sm:p-5 md:p-6 rounded-t-xl sm:rounded-t-2xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center">
                                        <i class="fas fa-edit text-white text-lg sm:text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg sm:text-xl font-bold text-white">Edit Academic Level</h3>
                                        <p class="text-xs sm:text-sm text-blue-100">Update academic level details</p>
                                    </div>
                                </div>
                                <button type="button" 
                                        onclick="document.getElementById('editLevelModal').classList.add('hidden')"
                                        class="text-white hover:text-red-200 transition-all transform hover:rotate-90 hover:scale-110 duration-300 p-1.5 sm:p-2">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Modal Body -->
                        <form id="editLevelForm" class="p-4 sm:p-5 md:p-6 space-y-4 sm:space-y-5">
                            <input type="hidden" id="edit_level_id" name="level_id">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="edit_level_category" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Level Category <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           id="edit_level_category" 
                                           name="level_category" 
                                           required
                                           class="academic-level-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                </div>
                                <div>
                                    <label for="edit_level_name" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Level Name <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           id="edit_level_name" 
                                           name="level_name" 
                                           required
                                           class="academic-level-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                </div>
                            </div>

                            <div>
                                <label for="edit_level_description" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    Level Description
                                </label>
                                <textarea id="edit_level_description" 
                                          name="level_description" 
                                          rows="3"
                                          class="academic-level-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none"></textarea>
                            </div>

                            <div>
                                <label class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-gray-200 dark:border-gray-600">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">
                                            <i class="fas fa-toggle-on text-blue-600 mr-2"></i>
                                            Level Status
                                        </span>
                                        <span id="edit_status_label" class="text-sm font-medium text-green-600 dark:text-green-400">Active</span>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" 
                                               id="edit_level_status" 
                                               name="level_status" 
                                               checked
                                               class="sr-only peer">
                                        <input type="hidden" 
                                               id="edit_level_status_value" 
                                               name="level_status_value" 
                                               value="active">
                                        <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                    </label>
                                </label>
                            </div>

                            <!-- Modal Footer -->
                            <div class="flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <button type="button" 
                                        onclick="document.getElementById('editLevelModal').classList.add('hidden')"
                                        class="px-4 sm:px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                                    Cancel
                                </button>
                                <button type="submit" 
                                        class="px-4 sm:px-6 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all duration-300">
                                    <i class="fas fa-save mr-2"></i>
                                    Update Level
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Academic Year Settings Section -->
            <div x-show="activeSubSection === 'academic-year'" x-cloak style="display: none;">
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 mb-6 border border-green-200 dark:border-green-800">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 flex items-center">
                        <i class="fas fa-calendar-check text-green-600 dark:text-green-400 mr-3"></i>
                        Academic Year Settings
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">This defines the financial timeline of the school.</p>
                    <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-3 mt-3">
                        <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">System Rules:</p>
                        <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside">
                            <li>Multiple academic years can be active, but only ONE can be marked as "Is Current"</li>
                            <li>You cannot delete an academic year with financial records</li>
                            <li>Closing an academic year: Locks all terms, Carries forward balances, Prevents backdated payments</li>
                        </ul>
                    </div>
                </div>

                <!-- Current Academic Year Card -->
                {% if current_academic_year %}
                <div class="current-year-card bg-gradient-to-br from-green-500 via-green-600 to-emerald-600 rounded-2xl shadow-2xl p-6 sm:p-8 mb-6 text-white gradient-animated">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <i class="fas fa-star icon-animated text-yellow-300"></i>
                                <p class="text-sm sm:text-base font-medium opacity-90">Current Academic Year</p>
                        </div>
                            <h4 class="text-2xl sm:text-3xl md:text-4xl font-bold mb-2">{{ current_academic_year.year_name }}</h4>
                            <p class="text-sm sm:text-base opacity-90 flex items-center gap-2">
                                <i class="fas fa-calendar-day icon-pulse"></i>
                                <span>
                                    {{ current_academic_year.start_date.strftime('%B %d, %Y') if current_academic_year.start_date else 'N/A' }} - 
                                    {{ current_academic_year.end_date.strftime('%B %d, %Y') if current_academic_year.end_date else 'N/A' }}
                                </span>
                            </p>
                        </div>
                        <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-4 sm:p-6 shadow-xl">
                            <i class="fas fa-calendar-alt text-4xl sm:text-5xl md:text-6xl icon-animated"></i>
                    </div>
                </div>
                </div>
                {% endif %}

                <!-- Add New Academic Year Form -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-6 mb-6 modern-card">
                    <h4 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6 flex items-center">
                        <i class="fas fa-plus-circle text-green-600 mr-2 sm:mr-3 icon-pulse text-xl sm:text-2xl"></i>
                        <span>Create New Academic Year</span>
                    </h4>
                    <form action="/system-settings/academic-year" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-5">
                        <div>
                            <label for="year_name" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Academic Year Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text" 
                                   id="year_name" 
                                   name="year_name" 
                                   placeholder="e.g., 2025, 2025/2026"
                                   required
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400 dark:hover:border-green-500">
                        </div>
                        <div>
                            <label for="status" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Status <span class="text-red-500">*</span>
                            </label>
                            <select id="status" 
                                    name="status" 
                                   required
                                    class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400 dark:hover:border-green-500">
                                <option value="draft">Draft</option>
                                <option value="active">Active</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        <div>
                            <label for="start_date" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Start Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" 
                                   id="start_date" 
                                   name="start_date" 
                                   required
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400 dark:hover:border-green-500">
                        </div>
                        <div>
                            <label for="end_date" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                End Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" 
                                   id="end_date" 
                                   name="end_date" 
                                   required
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400 dark:hover:border-green-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" 
                                       id="is_current" 
                                       name="is_current"
                                       value="true"
                                       class="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">Is Current (Yes/No)</span>
                            </label>
                        </div>
                        <div class="md:col-span-2 flex justify-end space-x-3">
                            <button type="button" 
                                    class="px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all">
                                Cancel
                            </button>
                            <button type="submit" 
                                    class="btn-modern px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-green-500 via-green-600 to-emerald-600 text-white rounded-xl font-semibold shadow-lg">
                                <i class="fas fa-save mr-2 icon-bounce"></i>
                                <span class="hidden sm:inline">Create Academic Year</span>
                                <span class="sm:hidden">Create</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Academic Years List -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6">
                    <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-list text-green-600 mr-2"></i>
                        All Academic Years
                        {% if academic_years and academic_years|length > 0 %}
                        <span class="text-sm font-normal text-gray-500 dark:text-gray-400 ml-2">
                            ({{ academic_years|length }} year{{ 's' if academic_years|length != 1 else '' }})
                        </span>
                        {% endif %}
                    </h4>
                    {% if academic_years and academic_years|length > 0 %}
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                        {% for year in academic_years %}
                        <div class="modern-card border-2 {% if year.is_current %}border-green-500 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/30 dark:to-emerald-900/20{% elif year.status == 'active' %}border-blue-500 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/20{% else %}border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800{% endif %} rounded-xl p-4 sm:p-5">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex flex-wrap items-center gap-2">
                                    {% if year.is_current %}
                                    <span class="badge-modern text-xs font-bold text-green-700 dark:text-green-300 bg-green-200 dark:bg-green-800 px-2.5 py-1.5 rounded-full flex items-center gap-1">
                                        <i class="fas fa-star icon-pulse text-xs"></i>
                                        <span>CURRENT</span>
                                    </span>
                                    {% endif %}
                                    {% if year.status == 'active' %}
                                    <span class="badge-modern text-xs font-bold text-blue-700 dark:text-blue-300 bg-blue-200 dark:bg-blue-800 px-2.5 py-1.5 rounded-full flex items-center gap-1">
                                        <i class="fas fa-circle icon-pulse text-xs"></i>
                                        <span>ACTIVE</span>
                                    </span>
                                    {% elif year.status == 'closed' %}
                                    <span class="badge-modern text-xs font-bold text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-800 px-2.5 py-1.5 rounded-full">
                                        CLOSED
                                    </span>
                                    {% elif year.status == 'suspended' %}
                                    <span class="badge-modern text-xs font-bold text-orange-700 dark:text-orange-300 bg-orange-200 dark:bg-orange-800 px-2.5 py-1.5 rounded-full flex items-center gap-1">
                                        <i class="fas fa-pause icon-pulse text-xs"></i>
                                        <span>SUSPENDED</span>
                                    </span>
                                    {% else %}
                                    <span class="badge-modern text-xs font-bold text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2.5 py-1.5 rounded-full">
                                        DRAFT
                                    </span>
                                    {% endif %}
                                    {% if year.is_locked %}
                                    <span class="badge-modern text-xs font-bold text-red-700 dark:text-red-300 bg-red-200 dark:bg-red-800 px-2.5 py-1.5 rounded-full flex items-center gap-1">
                                        <i class="fas fa-lock icon-pulse text-xs"></i>
                                        <span>LOCKED</span>
                                    </span>
                                    {% endif %}
                            </div>
                                {% if year.is_current %}
                                <i class="fas fa-check-circle text-green-600 text-xl icon-animated"></i>
                                {% endif %}
                        </div>
                            <div class="mb-3">
                                <h5 class="font-bold text-gray-900 dark:text-white text-lg sm:text-xl mb-2 flex items-center gap-2">
                                    <i class="fas fa-calendar text-green-600 dark:text-green-400 icon-hover-effect"></i>
                                    <span>{{ year.year_name }}</span>
                                </h5>
                                <p class="text-sm text-gray-600 dark:text-gray-400 flex items-center gap-2">
                                    <i class="fas fa-clock text-xs"></i>
                                    <span>
                                        {{ year.start_date.strftime('%b %d, %Y') if year.start_date else 'N/A' }} - 
                                        {{ year.end_date.strftime('%b %d, %Y') if year.end_date else 'N/A' }}
                                    </span>
                                </p>
                            </div>
                            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                                <div class="flex items-center gap-2">
                                    <!-- Suspend/Unsuspend Toggle -->
                                    <button type="button" 
                                            class="action-btn toggle-suspend-year-btn {% if year.status == 'suspended' %}text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300 bg-green-50 dark:bg-green-900/20{% else %}text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-300 bg-orange-50 dark:bg-orange-900/20{% endif %} p-2.5 rounded-xl touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="{% if year.status == 'suspended' %}Unsuspend Academic Year{% else %}Suspend Academic Year{% endif %}"
                                            data-year-id="{{ year.id }}"
                                            data-year-status="{{ year.status }}">
                                        <i class="fas {% if year.status == 'suspended' %}fa-play{% else %}fa-pause{% endif %} text-base sm:text-lg icon-rotate"></i>
                                    </button>
                                    <!-- Lock/Unlock Toggle -->
                                    <button type="button" 
                                            class="action-btn toggle-lock-year-btn {% if year.is_locked %}text-yellow-600 hover:text-yellow-900 dark:text-yellow-400 dark:hover:text-yellow-300 bg-yellow-50 dark:bg-yellow-900/20{% else %}text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 bg-gray-50 dark:bg-gray-900/20{% endif %} p-2.5 rounded-xl touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="{% if year.is_locked %}Unlock Academic Year{% else %}Lock Academic Year{% endif %}"
                                            data-year-id="{{ year.id }}"
                                            data-year-locked="{{ 'true' if year.is_locked else 'false' }}">
                                        <i class="fas {% if year.is_locked %}fa-unlock{% else %}fa-lock{% endif %} text-base sm:text-lg icon-rotate"></i>
                                    </button>
                        </div>
                                <div class="flex items-center gap-2">
                                    <button type="button" 
                                            class="action-btn edit-year-btn text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 p-2.5 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="Edit"
                                            data-year-id="{{ year.id }}"
                                            data-year-name="{{ year.year_name }}"
                                            data-start-date="{{ year.start_date.strftime('%Y-%m-%d') if year.start_date else '' }}"
                                            data-end-date="{{ year.end_date.strftime('%Y-%m-%d') if year.end_date else '' }}"
                                            data-status="{{ year.status }}"
                                            data-is-current="{{ 'true' if year.is_current else 'false' }}">
                                        <i class="fas fa-edit text-base sm:text-lg"></i>
                                    </button>
                                    <button type="button" 
                                            class="action-btn delete-year-btn text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 p-2.5 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="Delete"
                                            data-year-id="{{ year.id }}"
                                            data-year-name="{{ year.year_name }}">
                                        <i class="fas fa-trash text-base sm:text-lg"></i>
                                    </button>
                    </div>
                </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-inbox text-4xl mb-3 opacity-50"></i>
                        <p>No academic years registered yet</p>
                    </div>
                    {% endif %}
            </div>

                <!-- Edit Academic Year Modal -->
                <div id="editYearModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-3 sm:p-4 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-2xl max-h-[95vh] overflow-y-auto" @click.stop>
                        <!-- Modal Header -->
                        <div class="bg-gradient-to-r from-green-500 to-emerald-600 p-4 sm:p-5 md:p-6 rounded-t-xl sm:rounded-t-2xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center">
                                        <i class="fas fa-edit text-white text-lg sm:text-xl icon-animated"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg sm:text-xl font-bold text-white">Edit Academic Year</h3>
                                        <p class="text-xs sm:text-sm text-green-100">Update academic year details</p>
                                    </div>
                                </div>
                                <button type="button" 
                                        id="closeEditYearModalBtn"
                                        class="close-edit-year-modal text-white hover:text-red-200 transition-all transform hover:rotate-90 hover:scale-110 duration-300 p-1.5 sm:p-2 touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                        title="Close">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                </div>

                        <!-- Modal Body -->
                        <form id="editYearForm" class="p-4 sm:p-5 md:p-6 space-y-4 sm:space-y-5">
                            <input type="hidden" id="edit_year_id" name="year_id">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="edit_year_name" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Academic Year Name <span class="text-red-500">*</span>
                    </label>
                                    <input type="text" 
                                           id="edit_year_name" 
                                           name="year_name" 
                                           required
                                           placeholder="e.g., 2025, 2025/2026"
                                           class="year-name-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400">
                                </div>
                                <div>
                                    <label for="edit_year_status" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Status <span class="text-red-500">*</span>
                                    </label>
                                    <select id="edit_year_status" 
                                            name="status" 
                                            required
                                            class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400">
                                        <option value="draft">Draft</option>
                                        <option value="active">Active</option>
                                        <option value="suspended">Suspended</option>
                                        <option value="closed">Closed</option>
                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="edit_year_start_date" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Start Date <span class="text-red-500">*</span>
                                    </label>
                                    <input type="date" 
                                           id="edit_year_start_date" 
                                           name="start_date" 
                                           required
                                           class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400">
                                </div>
                                <div>
                                    <label for="edit_year_end_date" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        End Date <span class="text-red-500">*</span>
                                    </label>
                                    <input type="date" 
                                           id="edit_year_end_date" 
                                           name="end_date" 
                                           required
                                           class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all hover:border-green-400">
                                </div>
                            </div>

                            <div>
                                <label class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl border-2 border-gray-200 dark:border-gray-600">
                                    <div class="flex items-center space-x-3">
                                        <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">
                                            <i class="fas fa-star text-green-600 mr-2"></i>
                                            Is Current Academic Year
                                        </span>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" 
                                               id="edit_year_is_current" 
                                               name="is_current" 
                                               class="sr-only peer">
                                        <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
                                    </label>
                                </label>
                            </div>

                            <!-- Modal Footer -->
                            <div class="flex flex-col sm:flex-row justify-between items-center gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <button type="button" 
                                        id="cancelEditYearBtn"
                                        class="close-edit-year-modal px-4 sm:px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all touch-manipulation flex items-center gap-2">
                                    <i class="fas fa-times"></i>
                                    <span>Cancel</span>
                                </button>
                                <div class="flex gap-3">
                                    <button type="button" 
                                            id="closeEditYearModalFooterBtn"
                                            class="close-edit-year-modal px-4 sm:px-6 py-2.5 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-400 dark:hover:bg-gray-500 transition-all touch-manipulation flex items-center gap-2">
                                        <i class="fas fa-times-circle"></i>
                                        <span class="hidden sm:inline">Close</span>
                                    </button>
                                    <button type="submit" 
                                            id="updateYearBtn"
                                            class="btn-modern px-4 sm:px-6 py-2.5 bg-gradient-to-r from-green-500 via-green-600 to-emerald-600 text-white rounded-xl font-semibold shadow-lg flex items-center gap-2">
                                        <i class="fas fa-save icon-bounce"></i>
                                        <span>Update Academic Year</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Term Settings Section -->
            <div x-show="activeSubSection === 'term-settings'" x-cloak style="display: none;">
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl p-4 sm:p-6 mb-6 border border-purple-200 dark:border-purple-800 shadow-lg">
                    <h3 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-2 sm:mb-3 flex items-center">
                        <i class="fas fa-calendar-week text-purple-600 dark:text-purple-400 mr-2 sm:mr-3 text-2xl sm:text-3xl icon-animated"></i>
                        <span>Term Settings</span>
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-2">Each academic year contains multiple terms.</p>
                    <div class="bg-white/50 dark:bg-gray-800/50 rounded-lg p-3 mt-3">
                        <p class="text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">Rules:</p>
                        <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1 list-disc list-inside">
                            <li>Only one term active at a time</li>
                            <li>You cannot edit fee amounts once term is active</li>
                            <li>Closing a term: Locks invoices, Locks payments, Moves balances forward</li>
                        </ul>
                    </div>
                </div>

                <!-- Add New Term Form -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-6 mb-6 modern-card">
                    <h4 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6 flex items-center">
                        <i class="fas fa-plus-circle text-purple-600 mr-2 sm:mr-3 icon-pulse text-xl sm:text-2xl"></i>
                        <span>Add New Term</span>
                    </h4>
                    <form action="/system-settings/term" method="POST" class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-5">
                        <div>
                            <label for="term_name" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Term Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text" 
                                   id="term_name" 
                                    name="term_name" 
                                   placeholder="Term 1, Term 2, Term 3 / Semester 1, Semester 2"
                                    required
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400 dark:hover:border-purple-500">
                        </div>
                        <div>
                            <label for="academic_year_id" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Academic Year (FK) <span class="text-red-500">*</span>
                            </label>
                            <select id="academic_year_id" 
                                    name="academic_year_id" 
                                    required
                                    class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400 dark:hover:border-purple-500">
                                <option value="">-- Select Academic Year --</option>
                                {% if academic_years %}
                                    {% for year in academic_years %}
                                    <option value="{{ year.id }}">{{ year.year_name }}</option>
                                    {% endfor %}
                                {% endif %}
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Academic Levels <span class="text-gray-400 text-xs">(Check to link - only active levels shown)</span>
                            </label>
                            <div class="border-2 border-gray-300 dark:border-gray-600 rounded-xl p-3 bg-white dark:bg-gray-700 h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-purple-500 scrollbar-track-gray-200 dark:scrollbar-track-gray-700">
                                {% if academic_levels %}
                                    <div class="space-y-2">
                                        {% for level in academic_levels %}
                                            {% if level.level_status == 'active' %}
                                            <label class="academic-level-label flex items-center space-x-3 py-2 px-2 rounded hover:bg-purple-50 dark:hover:bg-purple-900/20 cursor-pointer transition-colors">
                                                <input type="checkbox" 
                                                       name="academic_level_ids" 
                                                       value="{{ level.id }}"
                                                       class="academic-level-checkbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer">
                                                <span class="level-name text-sm text-gray-900 dark:text-white">
                                                    {{ level.level_name }} <span class="text-gray-500 dark:text-gray-400">({{ level.level_category }})</span>
                                                </span>
                                            </label>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                                        <i class="fas fa-info-circle mr-2"></i>No active academic levels available
                                    </p>
                                {% endif %}
                            </div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                <i class="fas fa-info-circle"></i> Check the boxes to link academic levels to this term
                            </p>
                        </div>
                        <div>
                            <label for="status" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Status <span class="text-red-500">*</span>
                            </label>
                            <select id="status" 
                                    name="status" 
                                   required
                                    class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400 dark:hover:border-purple-500">
                                <option value="draft">Draft</option>
                                <option value="active">Active</option>
                                <option value="suspended">Suspended</option>
                                <option value="closed">Closed</option>
                            </select>
                        </div>
                        <div>
                            <label class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl border-2 border-gray-200 dark:border-gray-600">
                                <div class="flex items-center space-x-3">
                                    <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">
                                        <i class="fas fa-star text-yellow-600 mr-2"></i>
                                        Is Current Term
                                    </span>
                                    <span class="text-xs text-gray-500 dark:text-gray-400">(Only one can be current)</span>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" 
                                           id="is_current" 
                                           name="is_current" 
                                           value="true"
                                           class="sr-only peer">
                                    <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 dark:peer-focus:ring-yellow-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-yellow-600"></div>
                                </label>
                            </label>
                        </div>
                        <div>
                            <label for="term_start_date" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                Start Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" 
                                   id="term_start_date" 
                                   name="start_date" 
                                   required
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400 dark:hover:border-purple-500">
                            <p id="term_start_date_hint" class="text-xs text-gray-500 dark:text-gray-400 mt-1 hidden">
                                <i class="fas fa-info-circle"></i> Select a date within the academic year range
                            </p>
                        </div>
                        <div>
                            <label for="term_end_date" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                End Date <span class="text-red-500">*</span>
                            </label>
                            <input type="date" 
                                   id="term_end_date" 
                                   name="end_date" 
                                   required
                                   class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400 dark:hover:border-purple-500">
                            <p id="term_end_date_hint" class="text-xs text-gray-500 dark:text-gray-400 mt-1 hidden">
                                <i class="fas fa-info-circle"></i> Select a date within the academic year range
                            </p>
                        </div>
                        <div class="md:col-span-2 flex flex-col sm:flex-row justify-end gap-3 sm:gap-4">
                            <button type="button" 
                                    class="px-4 sm:px-6 py-2.5 sm:py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all touch-manipulation">
                                Cancel
                            </button>
                            <button type="submit" 
                                    class="btn-modern px-4 sm:px-6 py-2.5 sm:py-3 bg-gradient-to-r from-purple-500 via-purple-600 to-pink-600 text-white rounded-xl font-semibold shadow-lg">
                                <i class="fas fa-save mr-2 icon-bounce"></i>
                                <span class="hidden sm:inline">Add Term</span>
                                <span class="sm:hidden">Add</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Terms List -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-6">
                    <h4 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4 sm:mb-6 flex items-center">
                        <i class="fas fa-list text-purple-600 mr-2 sm:mr-3 text-xl sm:text-2xl icon-animated"></i>
                        <span>All Terms</span>
                        {% if terms and terms|length > 0 %}
                        <span class="text-sm font-normal text-gray-500 dark:text-gray-400 ml-2">
                            ({{ terms|length }} term{{ 's' if terms|length != 1 else '' }})
                        </span>
                        {% endif %}
                    </h4>
                    {% if terms and terms|length > 0 %}
                    <div class="space-y-3 sm:space-y-4">
                        {% for term in terms %}
                        <div class="modern-card border-2 {% if term.status == 'active' %}border-purple-500 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/30 dark:to-pink-900/20{% elif term.status == 'closed' %}border-gray-400 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700/50 dark:to-gray-800/50{% elif term.status == 'suspended' %}border-orange-500 bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-900/30 dark:to-amber-900/20{% else %}border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800{% endif %} rounded-xl p-4 sm:p-5">
                            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4 mb-3">
                                <div class="flex items-start sm:items-center gap-3 sm:gap-4 flex-1 min-w-0">
                                    <div class="w-12 h-12 sm:w-14 sm:h-14 {% if term.status == 'active' %}bg-gradient-to-br from-purple-500 to-pink-500{% elif term.status == 'suspended' %}bg-gradient-to-br from-orange-500 to-amber-500{% else %}bg-gray-300 dark:bg-gray-600{% endif %} rounded-xl flex items-center justify-center {% if term.status == 'active' or term.status == 'suspended' %}text-white shadow-lg{% else %}text-gray-700 dark:text-gray-300{% endif %} font-bold text-lg sm:text-xl icon-bounce">
                                        {{ loop.index }}
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h5 class="font-bold text-gray-900 dark:text-white text-base sm:text-lg mb-1.5 flex items-center gap-2">
                                            <i class="fas fa-calendar-week text-purple-600 dark:text-purple-400 icon-hover-effect"></i>
                                            <span class="truncate">{{ term.term_name }}</span>
                                        </h5>
                                        <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1.5 flex items-center gap-2">
                                            <i class="fas fa-clock text-xs"></i>
                                            <span class="truncate">
                                                {{ term.start_date.strftime('%b %d, %Y') if term.start_date else 'N/A' }} - 
                                                {{ term.end_date.strftime('%b %d, %Y') if term.end_date else 'N/A' }}
                                            </span>
                                        </p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 flex flex-wrap items-center gap-1.5">
                                            <i class="fas fa-graduation-cap text-xs"></i>
                                            <span class="truncate">{{ term.academic_year_name or 'N/A' }}</span>
                                            {% if term.academic_levels and term.academic_levels|length > 0 %}
                                            <span class="hidden sm:inline">|</span>
                                            <i class="fas fa-layer-group text-xs"></i>
                                            <span class="truncate">
                                                {% for level in term.academic_levels %}
                                                    {{ level.level_name }}{% if not loop.last %}, {% endif %}
                                                {% endfor %}
                                            </span>
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex flex-wrap items-center gap-2">
                                    {% if term.status == 'active' %}
                                    <span class="badge-modern text-xs font-bold text-purple-700 dark:text-purple-300 bg-purple-200 dark:bg-purple-800 px-2.5 py-1.5 rounded-full flex items-center gap-1">
                                        <i class="fas fa-circle icon-pulse text-xs"></i>
                                        <span>ACTIVE</span>
                                    </span>
                                    {% elif term.status == 'closed' %}
                                    <span class="badge-modern text-xs font-bold text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-800 px-2.5 py-1.5 rounded-full">
                                        CLOSED
                                    </span>
                                    {% elif term.status == 'suspended' %}
                                    <span class="badge-modern text-xs font-bold text-orange-700 dark:text-orange-300 bg-orange-200 dark:bg-orange-800 px-2.5 py-1.5 rounded-full flex items-center gap-1">
                                        <i class="fas fa-pause icon-pulse text-xs"></i>
                                        <span>SUSPENDED</span>
                                    </span>
                                    {% else %}
                                    <span class="badge-modern text-xs font-bold text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2.5 py-1.5 rounded-full">
                                        DRAFT
                                    </span>
                                    {% endif %}
                                    {% if term.is_current %}
                                    <span class="badge-modern text-xs font-bold text-yellow-700 dark:text-yellow-300 bg-yellow-200 dark:bg-yellow-800 px-2.5 py-1.5 rounded-full flex items-center gap-1">
                                        <i class="fas fa-star icon-pulse text-xs"></i>
                                        <span>CURRENT</span>
                                    </span>
                                    {% endif %}
                                    {% if term.is_locked %}
                                    <span class="badge-modern text-xs font-bold text-red-700 dark:text-red-300 bg-red-200 dark:bg-red-800 px-2.5 py-1.5 rounded-full flex items-center gap-1">
                                        <i class="fas fa-lock icon-pulse text-xs"></i>
                                        <span>LOCKED</span>
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                                <div class="flex items-center gap-2">
                                    <!-- Is Current Toggle -->
                                    <button type="button" 
                                            class="action-btn toggle-current-btn {% if term.is_current %}text-yellow-600 hover:text-yellow-900 dark:text-yellow-400 dark:hover:text-yellow-300 bg-yellow-50 dark:bg-yellow-900/20{% else %}text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300 bg-gray-50 dark:bg-gray-900/20{% endif %} p-2.5 rounded-xl touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="{% if term.is_current %}Mark as Not Current{% else %}Mark as Current Term{% endif %}"
                                            data-term-id="{{ term.id }}"
                                            data-term-current="{{ 'true' if term.is_current else 'false' }}">
                                        <i class="fas fa-star text-base sm:text-lg {% if term.is_current %}icon-pulse{% endif %}"></i>
                                    </button>
                                    <!-- Suspend/Unsuspend Toggle -->
                                    <button type="button" 
                                            class="action-btn toggle-suspend-btn {% if term.status == 'suspended' %}text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300 bg-green-50 dark:bg-green-900/20{% else %}text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-300 bg-orange-50 dark:bg-orange-900/20{% endif %} p-2.5 rounded-xl touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="{% if term.status == 'suspended' %}Unsuspend Term{% else %}Suspend Term{% endif %}"
                                            data-term-id="{{ term.id }}"
                                            data-term-status="{{ term.status }}">
                                        <i class="fas {% if term.status == 'suspended' %}fa-play{% else %}fa-pause{% endif %} text-base sm:text-lg icon-rotate"></i>
                                    </button>
                                    <!-- Lock/Unlock Toggle -->
                                    <button type="button" 
                                            class="action-btn toggle-lock-btn {% if term.is_locked %}text-yellow-600 hover:text-yellow-900 dark:text-yellow-400 dark:hover:text-yellow-300 bg-yellow-50 dark:bg-yellow-900/20{% else %}text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300 bg-gray-50 dark:bg-gray-900/20{% endif %} p-2.5 rounded-xl touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="{% if term.is_locked %}Unlock Term{% else %}Lock Term{% endif %}"
                                            data-term-id="{{ term.id }}"
                                            data-term-locked="{{ 'true' if term.is_locked else 'false' }}">
                                        <i class="fas {% if term.is_locked %}fa-unlock{% else %}fa-lock{% endif %} text-base sm:text-lg icon-rotate"></i>
                                    </button>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button type="button" 
                                            class="action-btn edit-term-btn text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300 p-2.5 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="Edit"
                                            data-term-id="{{ term.id }}"
                                            data-term-name="{{ term.term_name }}"
                                            data-academic-year-id="{{ term.academic_year_id }}"
                                            data-academic-level-ids="{{ term.academic_levels|map(attribute='id')|join(',') if term.academic_levels else '' }}"
                                            data-start-date="{{ term.start_date.strftime('%Y-%m-%d') if term.start_date else '' }}"
                                            data-end-date="{{ term.end_date.strftime('%Y-%m-%d') if term.end_date else '' }}"
                                            data-status="{{ term.status }}"
                                            data-is-current="{{ 'true' if term.is_current else 'false' }}">
                                        <i class="fas fa-edit text-base sm:text-lg"></i>
                                    </button>
                                    <button type="button" 
                                            class="action-btn delete-term-btn text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 p-2.5 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                            title="Delete"
                                            data-term-id="{{ term.id }}"
                                            data-term-name="{{ term.term_name }}">
                                        <i class="fas fa-trash text-base sm:text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                        <i class="fas fa-inbox text-4xl mb-3 opacity-50"></i>
                        <p>No terms registered yet</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Edit Term Modal -->
                <div id="editTermModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-3 sm:p-4 hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-3xl max-h-[95vh] overflow-y-auto" @click.stop>
                        <!-- Modal Header -->
                        <div class="bg-gradient-to-r from-purple-500 to-pink-600 p-4 sm:p-5 md:p-6 rounded-t-xl sm:rounded-t-2xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-lg sm:rounded-xl flex items-center justify-center">
                                        <i class="fas fa-edit text-white text-lg sm:text-xl icon-animated"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg sm:text-xl font-bold text-white">Edit Term</h3>
                                        <p class="text-xs sm:text-sm text-purple-100">Update term details</p>
                                    </div>
                                </div>
                                <button type="button" 
                                        id="closeEditTermModalBtn"
                                        class="close-edit-term-modal text-white hover:text-red-200 transition-all transform hover:rotate-90 hover:scale-110 duration-300 p-1.5 sm:p-2 touch-manipulation min-w-[44px] min-h-[44px] flex items-center justify-center"
                                        title="Close">
                                    <i class="fas fa-times text-xl"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Modal Body -->
                        <form id="editTermForm" class="p-4 sm:p-5 md:p-6 space-y-4 sm:space-y-5">
                            <input type="hidden" id="edit_term_id" name="term_id">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                    <label for="edit_term_name" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Term Name <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           id="edit_term_name" 
                                           name="term_name" 
                                           required
                                           class="term-name-uppercase w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400">
                                    </div>
                                <div>
                                    <label for="edit_term_academic_year_id" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Academic Year <span class="text-red-500">*</span>
                                    </label>
                                    <select id="edit_term_academic_year_id" 
                                            name="academic_year_id" 
                                            required
                                            class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400">
                                        <option value="">-- Select Academic Year --</option>
                                        {% if academic_years %}
                                            {% for year in academic_years %}
                                            <option value="{{ year.id }}">{{ year.year_name }}</option>
                                            {% endfor %}
                                        {% endif %}
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    Academic Levels <span class="text-gray-400 text-xs">(Check to link - only active levels shown)</span>
                                </label>
                                <div class="border-2 border-gray-300 dark:border-gray-600 rounded-xl p-3 bg-white dark:bg-gray-700 h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-purple-500 scrollbar-track-gray-200 dark:scrollbar-track-gray-700" id="edit_term_academic_levels_container">
                                    {% if academic_levels %}
                                        <div class="space-y-2">
                                            {% for level in academic_levels %}
                                                {% if level.level_status == 'active' %}
                                                <label class="academic-level-label flex items-center space-x-3 py-2 px-2 rounded hover:bg-purple-50 dark:hover:bg-purple-900/20 cursor-pointer transition-colors">
                                                    <input type="checkbox" 
                                                           name="academic_level_ids" 
                                                           value="{{ level.id }}"
                                                           class="academic-level-checkbox w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 cursor-pointer">
                                                    <span class="level-name text-sm text-gray-900 dark:text-white">
                                                        {{ level.level_name }} <span class="text-gray-500 dark:text-gray-400">({{ level.level_category }})</span>
                                                    </span>
                                                </label>
                                                {% endif %}
                                            {% endfor %}
                        </div>
                                    {% else %}
                                        <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                                            <i class="fas fa-info-circle mr-2"></i>No active academic levels available
                                        </p>
                                    {% endif %}
                                </div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    <i class="fas fa-info-circle"></i> Check the boxes to link academic levels to this term
                                </p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                    <label for="edit_term_start_date" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Start Date <span class="text-red-500">*</span>
                                    </label>
                                    <input type="date" 
                                           id="edit_term_start_date" 
                                           name="start_date" 
                                           required
                                           class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400">
                                    <p id="edit_term_start_date_hint" class="text-xs text-gray-500 dark:text-gray-400 mt-1 hidden">
                                        <i class="fas fa-info-circle"></i> Select a date within the academic year range
                                    </p>
                                    </div>
                                <div>
                                    <label for="edit_term_end_date" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        End Date <span class="text-red-500">*</span>
                                    </label>
                                    <input type="date" 
                                           id="edit_term_end_date" 
                                           name="end_date" 
                                           required
                                           class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400">
                                    <p id="edit_term_end_date_hint" class="text-xs text-gray-500 dark:text-gray-400 mt-1 hidden">
                                        <i class="fas fa-info-circle"></i> Select a date within the academic year range
                                    </p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="edit_term_status" class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                        Status <span class="text-red-500">*</span>
                                    </label>
                                    <select id="edit_term_status" 
                                            name="status" 
                                            required
                                            class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all hover:border-purple-400">
                                        <option value="draft">Draft</option>
                                        <option value="active">Active</option>
                                        <option value="suspended">Suspended</option>
                                        <option value="closed">Closed</option>
                                    </select>
                        </div>
                                <div>
                                    <label class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl border-2 border-gray-200 dark:border-gray-600">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-sm font-semibold text-gray-700 dark:text-gray-300">
                                                <i class="fas fa-star text-yellow-600 mr-2"></i>
                                                Is Current Term
                                            </span>
                                            <span id="edit_term_is_current_label" class="text-sm font-medium text-gray-500 dark:text-gray-400">No</span>
                    </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="edit_term_is_current" 
                                                   name="is_current" 
                                                   class="sr-only peer">
                                            <div class="w-14 h-7 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 dark:peer-focus:ring-yellow-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-yellow-600"></div>
                                        </label>
                                    </label>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                        <i class="fas fa-info-circle"></i> Only one term can be marked as current
                                    </p>
                                </div>
                            </div>

                            <!-- Modal Footer -->
                            <div class="flex flex-col sm:flex-row justify-between items-center gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <button type="button" 
                                        id="cancelEditTermBtn"
                                        class="close-edit-term-modal px-4 sm:px-6 py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all touch-manipulation flex items-center gap-2">
                                    <i class="fas fa-times"></i>
                                    <span>Cancel</span>
                                </button>
                                <div class="flex gap-3">
                                    <button type="button" 
                                            id="closeEditTermModalFooterBtn"
                                            class="close-edit-term-modal px-4 sm:px-6 py-2.5 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl font-semibold hover:bg-gray-400 dark:hover:bg-gray-500 transition-all touch-manipulation flex items-center gap-2">
                                        <i class="fas fa-times-circle"></i>
                                        <span class="hidden sm:inline">Close</span>
                                    </button>
                                    <button type="submit" 
                                            id="updateTermBtn"
                                            class="btn-modern px-4 sm:px-6 py-2.5 bg-gradient-to-r from-purple-500 via-purple-600 to-pink-600 text-white rounded-xl font-semibold shadow-lg flex items-center gap-2">
                                        <i class="fas fa-save icon-bounce"></i>
                                        <span>Update Term</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Theme / Colors -->
        <div x-show="activeSection === 'theme-colors'" x-cloak style="display: none;">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-palette text-green-600 mr-3"></i>
                Theme / Colors
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Customize the system theme, colors, and visual appearance.</p>
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <p class="text-sm text-gray-500 dark:text-gray-400">Theme / Colors settings will be displayed here</p>
                </div>
            </div>
        </div>

        <!-- Login Page Settings -->
        <div x-show="activeSection === 'login-settings'" x-cloak style="display: none;">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-sign-in-alt text-green-600 mr-3"></i>
                Login Page Settings
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Configure login page appearance and authentication settings.</p>
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <p class="text-sm text-gray-500 dark:text-gray-400">Login Page Settings will be displayed here</p>
                </div>
            </div>
        </div>

        <!-- Email (SMTP) Settings -->
        <div x-show="activeSection === 'email-settings'" x-cloak style="display: none;">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-envelope text-green-600 mr-3"></i>
                Email (SMTP) Settings
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Configure SMTP server settings for email notifications.</p>
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <p class="text-sm text-gray-500 dark:text-gray-400">Email (SMTP) Settings will be displayed here</p>
                </div>
            </div>
        </div>

        <!-- SMS Settings -->
        <div x-show="activeSection === 'sms-settings'" x-cloak style="display: none;">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-sms text-green-600 mr-3"></i>
                SMS Settings
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Configure SMS gateway settings for text message notifications.</p>
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <p class="text-sm text-gray-500 dark:text-gray-400">SMS Settings will be displayed here</p>
                </div>
            </div>
        </div>

        <!-- Notification Templates -->
        <div x-data="{ activeNotificationTab: 'general' }" x-show="activeSection === 'notification-templates'" x-cloak style="display: none;">
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-2xl p-4 sm:p-6 mb-6 border border-green-200 dark:border-green-800 shadow-lg">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-2 sm:mb-3 flex items-center">
                    <i class="fas fa-bell text-green-600 dark:text-green-400 mr-2 sm:mr-3 text-2xl sm:text-3xl icon-animated"></i>
                    <span>Notification Templates</span>
            </h2>
                <p class="text-gray-600 dark:text-gray-400 text-sm sm:text-base">Manage email and SMS notification templates for various system events.</p>
            </div>

            <!-- Notification Tabs -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 mb-6">
                <div class="border-b border-gray-200 dark:border-gray-700">
                    <nav class="flex flex-wrap -mb-px overflow-x-auto" aria-label="Tabs">
                        <button @click="activeNotificationTab = 'general'"
                                :class="activeNotificationTab === 'general' ? 'border-green-500 text-green-600 dark:text-green-400' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'"
                                class="whitespace-nowrap py-4 px-4 sm:px-6 border-b-2 font-medium text-sm transition-all duration-200 flex items-center space-x-2">
                            <i class="fas fa-bell"></i>
                            <span>General Notification</span>
                        </button>
                        <button @click="activeNotificationTab = 'academic-dates'"
                                :class="activeNotificationTab === 'academic-dates' ? 'border-green-500 text-green-600 dark:text-green-400' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'"
                                class="whitespace-nowrap py-4 px-4 sm:px-6 border-b-2 font-medium text-sm transition-all duration-200 flex items-center space-x-2">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Academic Dates Notification</span>
                        </button>
                        <button @click="activeNotificationTab = 'system'"
                                :class="activeNotificationTab === 'system' ? 'border-green-500 text-green-600 dark:text-green-400' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'"
                                class="whitespace-nowrap py-4 px-4 sm:px-6 border-b-2 font-medium text-sm transition-all duration-200 flex items-center space-x-2">
                            <i class="fas fa-cog"></i>
                            <span>System Notifications</span>
                        </button>
                        <button @click="activeNotificationTab = 'announcements'"
                                :class="activeNotificationTab === 'announcements' ? 'border-green-500 text-green-600 dark:text-green-400' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300'"
                                class="whitespace-nowrap py-4 px-4 sm:px-6 border-b-2 font-medium text-sm transition-all duration-200 flex items-center space-x-2">
                            <i class="fas fa-bullhorn"></i>
                            <span>Announcements Notifications</span>
                        </button>
                    </nav>
                </div>

                <!-- General Notification Tab -->
                <div x-show="activeNotificationTab === 'general'" x-cloak class="p-4 sm:p-6">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-bell text-blue-600 mr-2"></i>
                        General Notification Templates
                    </h3>
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center">
                        <i class="fas fa-info-circle text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-600 dark:text-gray-400">General notification templates will be displayed here</p>
                    </div>
                </div>

                <!-- Academic Dates Notification Tab -->
                <div x-show="activeNotificationTab === 'academic-dates'" x-cloak class="p-4 sm:p-6">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-calendar-alt text-orange-600 mr-2"></i>
                        Academic Dates Notification
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <!-- Academic Years Closing Soon -->
                        <div class="border-2 border-green-200 dark:border-green-800 rounded-xl p-4 bg-green-50 dark:bg-green-900/20">
                            <h4 class="font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                                <i class="fas fa-calendar-check text-green-600 mr-2"></i>
                                Academic Year End Dates
                            </h4>
                            {% if academic_years %}
                                <div class="space-y-2 max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-green-500 scrollbar-track-gray-200 dark:scrollbar-track-gray-700">
                                    {% set has_upcoming = false %}
                                    {% for year in academic_years %}
                                        {% if year.end_date and year.status != 'closed' %}
                                            {% set has_upcoming = true %}
                                            <div class="bg-white dark:bg-gray-700 rounded-lg p-3 border border-green-300 dark:border-green-700">
                                                <div class="flex items-center justify-between mb-1">
                                                    <span class="font-medium text-gray-900 dark:text-white text-sm">{{ year.year_name }}</span>
                                                    {% if year.days_remaining is not none %}
                                                    <span class="text-xs font-bold {% if year.days_remaining <= 7 %}text-red-600{% elif year.days_remaining <= 30 %}text-orange-600{% else %}text-green-600{% endif %}">
                                                        {{ year.days_remaining }} day{{ 's' if year.days_remaining != 1 else '' }} left
                                                    </span>
                                                    {% endif %}
                                                </div>
                                                <p class="text-xs text-gray-600 dark:text-gray-400">
                                                    <i class="fas fa-calendar-times mr-1"></i>
                                                    End Date: {{ year.end_date.strftime('%B %d, %Y') if year.end_date else 'N/A' }}
                                                </p>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                {% if not has_upcoming %}
                                    <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                                        <i class="fas fa-info-circle mr-2"></i>No active academic years found
                                    </p>
                                {% endif %}
                            {% else %}
                                <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                                    <i class="fas fa-inbox mr-2"></i>No academic years found
                                </p>
                            {% endif %}
                        </div>
                        
                        <!-- Terms Closing Soon -->
                        <div class="border-2 border-purple-200 dark:border-purple-800 rounded-xl p-4 bg-purple-50 dark:bg-purple-900/20">
                            <h4 class="font-semibold text-gray-900 dark:text-white mb-3 flex items-center">
                                <i class="fas fa-calendar-week text-purple-600 mr-2"></i>
                                Term End Dates
                            </h4>
                            {% if terms %}
                                <div class="space-y-2 max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-purple-500 scrollbar-track-gray-200 dark:scrollbar-track-gray-700">
                                    {% set has_upcoming_terms = false %}
                                    {% for term in terms %}
                                        {% if term.end_date and term.status != 'closed' %}
                                            {% set has_upcoming_terms = true %}
                                            <div class="bg-white dark:bg-gray-700 rounded-lg p-3 border border-purple-300 dark:border-purple-700">
                                                <div class="flex items-center justify-between mb-1">
                                                    <span class="font-medium text-gray-900 dark:text-white text-sm">{{ term.term_name }}</span>
                                                    {% if term.days_remaining is not none %}
                                                    <span class="text-xs font-bold {% if term.days_remaining <= 7 %}text-red-600{% elif term.days_remaining <= 30 %}text-orange-600{% else %}text-purple-600{% endif %}">
                                                        {{ term.days_remaining }} day{{ 's' if term.days_remaining != 1 else '' }} left
                                                    </span>
                                                    {% endif %}
                                                </div>
                                                <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">
                                                    <i class="fas fa-graduation-cap mr-1"></i>
                                                    {{ term.academic_year_name or 'N/A' }}
                                                </p>
                                                <p class="text-xs text-gray-600 dark:text-gray-400">
                                                    <i class="fas fa-calendar-times mr-1"></i>
                                                    End Date: {{ term.end_date.strftime('%B %d, %Y') if term.end_date else 'N/A' }}
                                                </p>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                {% if not has_upcoming_terms %}
                                    <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                                        <i class="fas fa-info-circle mr-2"></i>No active terms found
                                    </p>
                                {% endif %}
                            {% else %}
                                <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                                    <i class="fas fa-inbox mr-2"></i>No terms found
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- System Notifications Tab -->
                <div x-show="activeNotificationTab === 'system'" x-cloak class="p-4 sm:p-6">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-cog text-purple-600 mr-2"></i>
                        System Notifications
                    </h3>
                    <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6 text-center">
                        <i class="fas fa-info-circle text-4xl text-gray-400 mb-3"></i>
                        <p class="text-gray-600 dark:text-gray-400">System notification templates will be displayed here</p>
                    </div>
                </div>

                <!-- Announcements Notifications Tab -->
                <div x-show="activeNotificationTab === 'announcements'" x-cloak class="p-4 sm:p-6 space-y-6">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                        <i class="fas fa-bullhorn text-orange-600 mr-2"></i>
                        Announcements Notifications
                    </h3>

                    <!-- Academic Year Opening Notification -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-6 modern-card">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-calendar-plus text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Academic Year Opening Notification</h4>
                                    <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Notify users when academic year opens</p>
                                </div>
                            </div>
                            <span class="text-xs font-semibold text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 px-3 py-1.5 rounded-full">
                                <i class="fas fa-envelope mr-1"></i>Email & SMS
                            </span>
                        </div>

            <div class="space-y-4">
                            <!-- Email Template -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-envelope text-blue-600 mr-2"></i>Email Template
                                </label>
                                <textarea id="academic_year_opening_email_template" 
                                          rows="8"
                                          class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all resize-none"
                                          placeholder="Dear {parent_name},

We are pleased to inform you that the Academic Year {year_name} is now open.

Important Dates:
- Start Date: {start_date}
- End Date: {end_date}

Welcome back and we look forward to a successful academic year.

Best regards,
{school_name}">Dear {parent_name},

We are pleased to inform you that the Academic Year {year_name} is now open.

Important Dates:
- Start Date: {start_date}
- End Date: {end_date}

Welcome back and we look forward to a successful academic year.

Best regards,
{school_name}</textarea>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    <i class="fas fa-info-circle mr-1"></i>Available variables: {parent_name}, {year_name}, {start_date}, {end_date}, {school_name}
                                </p>
                            </div>

                            <!-- SMS Template -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-sms text-purple-600 mr-2"></i>SMS Template (Max 160 characters)
                                </label>
                                <textarea id="academic_year_opening_sms_template" 
                                          rows="4"
                                          maxlength="160"
                                          class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all resize-none"
                                          placeholder="Dear {parent_name}, Academic Year {year_name} is now open. Start: {start_date}, End: {end_date}. Welcome back! - {school_name}">Dear {parent_name}, Academic Year {year_name} is now open. Start: {start_date}, End: {end_date}. Welcome back! - {school_name}</textarea>
                                <div class="flex items-center justify-between mt-1">
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        <i class="fas fa-info-circle mr-1"></i>Available variables: {parent_name}, {year_name}, {start_date}, {end_date}, {school_name}
                                    </p>
                                    <span id="academic_year_opening_sms_count" class="text-xs font-semibold text-gray-500 dark:text-gray-400">0/160</span>
                                </div>
                            </div>

                            <!-- Notification Settings -->
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">
                                    <i class="fas fa-cog text-gray-600 mr-2"></i>Notification Settings
                                </label>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Enable Email Notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="academic_year_opening_email_enabled" 
                                                   checked
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Enable SMS Notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="academic_year_opening_sms_enabled" 
                                                   checked
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-end">
                                <button type="button" 
                                        class="btn-modern px-4 sm:px-6 py-2.5 bg-gradient-to-r from-green-500 via-green-600 to-emerald-600 text-white rounded-xl font-semibold shadow-lg">
                                    <i class="fas fa-save mr-2 icon-bounce"></i>
                                    Save Template
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Academic Year Closing Notification -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-6 modern-card">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-calendar-times text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Academic Year Closing Notification</h4>
                                    <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Notify users when academic year is closing</p>
                                </div>
                            </div>
                            <span class="text-xs font-semibold text-green-700 dark:text-green-300 bg-green-100 dark:bg-green-900/30 px-3 py-1.5 rounded-full">
                                <i class="fas fa-envelope mr-1"></i>Email & SMS
                            </span>
                        </div>

                        <div class="space-y-4">
                            <!-- Email Template -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-envelope text-blue-600 mr-2"></i>Email Template
                                </label>
                                <textarea id="academic_year_closing_email_template" 
                                          rows="8"
                                          class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all resize-none"
                                          placeholder="Dear {parent_name},

This is to inform you that the Academic Year {year_name} will be closing in {days_remaining} day(s).

Important Dates:
- End Date: {end_date}

Please ensure all outstanding fees and obligations are settled before the closing date.

Thank you for your cooperation.

Best regards,
{school_name}">Dear {parent_name},

This is to inform you that the Academic Year {year_name} will be closing in {days_remaining} day(s).

Important Dates:
- End Date: {end_date}

Please ensure all outstanding fees and obligations are settled before the closing date.

Thank you for your cooperation.

Best regards,
{school_name}</textarea>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    <i class="fas fa-info-circle mr-1"></i>Available variables: {parent_name}, {year_name}, {days_remaining}, {end_date}, {start_date}, {school_name}
                                </p>
                            </div>

                            <!-- SMS Template -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-sms text-purple-600 mr-2"></i>SMS Template (Max 160 characters)
                                </label>
                                <textarea id="academic_year_closing_sms_template" 
                                          rows="4"
                                          maxlength="160"
                                          class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all resize-none"
                                          placeholder="Dear {parent_name}, Academic Year {year_name} closes in {days_remaining} day(s). End date: {end_date}. Please settle all fees. - {school_name}">Dear {parent_name}, Academic Year {year_name} closes in {days_remaining} day(s). End date: {end_date}. Please settle all fees. - {school_name}</textarea>
                                <div class="flex items-center justify-between mt-1">
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        <i class="fas fa-info-circle mr-1"></i>Available variables: {parent_name}, {year_name}, {days_remaining}, {end_date}, {school_name}
                                    </p>
                                    <span id="academic_year_closing_sms_count" class="text-xs font-semibold text-gray-500 dark:text-gray-400">0/160</span>
                                </div>
                            </div>

                            <!-- Notification Settings -->
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">
                                    <i class="fas fa-cog text-gray-600 mr-2"></i>Notification Settings
                                </label>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Send notification when</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Days before closing</p>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="number" 
                                                   id="academic_year_closing_notify_days" 
                                                   min="1" 
                                                   max="90" 
                                                   value="7"
                                                   class="w-20 px-3 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">days</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Enable Email Notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="academic_year_closing_email_enabled" 
                                                   checked
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Enable SMS Notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="academic_year_closing_sms_enabled" 
                                                   checked
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-end">
                                <button type="button" 
                                        class="btn-modern px-4 sm:px-6 py-2.5 bg-gradient-to-r from-green-500 via-green-600 to-emerald-600 text-white rounded-xl font-semibold shadow-lg">
                                    <i class="fas fa-save mr-2 icon-bounce"></i>
                                    Save Template
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Term Opening Notification -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-6 modern-card">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-calendar-plus text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Term Opening Notification</h4>
                                    <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Notify users when term opens</p>
                                </div>
                            </div>
                            <span class="text-xs font-semibold text-purple-700 dark:text-purple-300 bg-purple-100 dark:bg-purple-900/30 px-3 py-1.5 rounded-full">
                                <i class="fas fa-envelope mr-1"></i>Email & SMS
                            </span>
                        </div>

                        <div class="space-y-4">
                            <!-- Email Template -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-envelope text-blue-600 mr-2"></i>Email Template
                                </label>
                                <textarea id="term_opening_email_template" 
                                          rows="8"
                                          class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all resize-none"
                                          placeholder="Dear {parent_name},

We are pleased to inform you that {term_name} for Academic Year {year_name} is now open.

Important Dates:
- Start Date: {start_date}
- End Date: {end_date}

Welcome back and we look forward to a successful term.

Best regards,
{school_name}">Dear {parent_name},

We are pleased to inform you that {term_name} for Academic Year {year_name} is now open.

Important Dates:
- Start Date: {start_date}
- End Date: {end_date}

Welcome back and we look forward to a successful term.

Best regards,
{school_name}</textarea>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    <i class="fas fa-info-circle mr-1"></i>Available variables: {parent_name}, {term_name}, {year_name}, {start_date}, {end_date}, {school_name}
                                </p>
                            </div>

                            <!-- SMS Template -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-sms text-purple-600 mr-2"></i>SMS Template (Max 160 characters)
                                </label>
                                <textarea id="term_opening_sms_template" 
                                          rows="4"
                                          maxlength="160"
                                          class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all resize-none"
                                          placeholder="Dear {parent_name}, {term_name} is now open. Start: {start_date}, End: {end_date}. Welcome back! - {school_name}">Dear {parent_name}, {term_name} is now open. Start: {start_date}, End: {end_date}. Welcome back! - {school_name}</textarea>
                                <div class="flex items-center justify-between mt-1">
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        <i class="fas fa-info-circle mr-1"></i>Available variables: {parent_name}, {term_name}, {year_name}, {start_date}, {end_date}, {school_name}
                                    </p>
                                    <span id="term_opening_sms_count" class="text-xs font-semibold text-gray-500 dark:text-gray-400">0/160</span>
                                </div>
                            </div>

                            <!-- Notification Settings -->
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">
                                    <i class="fas fa-cog text-gray-600 mr-2"></i>Notification Settings
                                </label>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Enable Email Notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="term_opening_email_enabled" 
                                                   checked
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Enable SMS Notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="term_opening_sms_enabled" 
                                                   checked
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-end">
                                <button type="button" 
                                        class="btn-modern px-4 sm:px-6 py-2.5 bg-gradient-to-r from-purple-500 via-purple-600 to-pink-600 text-white rounded-xl font-semibold shadow-lg">
                                    <i class="fas fa-save mr-2 icon-bounce"></i>
                                    Save Template
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Term Closing Notification -->
                    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-4 sm:p-6 modern-card">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center shadow-lg">
                                    <i class="fas fa-calendar-times text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Term Closing Notification</h4>
                                    <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">Notify users when term is closing</p>
                                </div>
                            </div>
                            <span class="text-xs font-semibold text-purple-700 dark:text-purple-300 bg-purple-100 dark:bg-purple-900/30 px-3 py-1.5 rounded-full">
                                <i class="fas fa-envelope mr-1"></i>Email & SMS
                            </span>
                        </div>

                        <div class="space-y-4">
                            <!-- Email Template -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-envelope text-blue-600 mr-2"></i>Email Template
                                </label>
                                <textarea id="term_closing_email_template" 
                                          rows="8"
                                          class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all resize-none"
                                          placeholder="Dear {parent_name},

This is to inform you that {term_name} for Academic Year {year_name} will be closing in {days_remaining} day(s).

Important Dates:
- End Date: {end_date}

Please ensure all outstanding fees and obligations are settled before the closing date.

Thank you for your cooperation.

Best regards,
{school_name}">Dear {parent_name},

This is to inform you that {term_name} for Academic Year {year_name} will be closing in {days_remaining} day(s).

Important Dates:
- End Date: {end_date}

Please ensure all outstanding fees and obligations are settled before the closing date.

Thank you for your cooperation.

Best regards,
{school_name}</textarea>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    <i class="fas fa-info-circle mr-1"></i>Available variables: {parent_name}, {term_name}, {year_name}, {days_remaining}, {end_date}, {start_date}, {school_name}
                                </p>
                            </div>

                            <!-- SMS Template -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
                                    <i class="fas fa-sms text-purple-600 mr-2"></i>SMS Template (Max 160 characters)
                                </label>
                                <textarea id="term_closing_sms_template" 
                                          rows="4"
                                          maxlength="160"
                                          class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all resize-none"
                                          placeholder="Dear {parent_name}, {term_name} closes in {days_remaining} day(s). End date: {end_date}. Please settle all fees. - {school_name}">Dear {parent_name}, {term_name} closes in {days_remaining} day(s). End date: {end_date}. Please settle all fees. - {school_name}</textarea>
                                <div class="flex items-center justify-between mt-1">
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        <i class="fas fa-info-circle mr-1"></i>Available variables: {parent_name}, {term_name}, {year_name}, {days_remaining}, {end_date}, {school_name}
                                    </p>
                                    <span id="term_closing_sms_count" class="text-xs font-semibold text-gray-500 dark:text-gray-400">0/160</span>
                                </div>
                            </div>

                            <!-- Notification Settings -->
                            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">
                                    <i class="fas fa-cog text-gray-600 mr-2"></i>Notification Settings
                                </label>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Send notification when</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Days before closing</p>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="number" 
                                                   id="term_closing_notify_days" 
                                                   min="1" 
                                                   max="90" 
                                                   value="7"
                                                   class="w-20 px-3 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                            <span class="text-sm text-gray-600 dark:text-gray-400">days</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Enable Email Notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="term_closing_email_enabled" 
                                                   checked
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium text-gray-900 dark:text-white">Enable SMS Notifications</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" 
                                                   id="term_closing_sms_enabled" 
                                                   checked
                                                   class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-end">
                                <button type="button" 
                                        class="btn-modern px-4 sm:px-6 py-2.5 bg-gradient-to-r from-purple-500 via-purple-600 to-pink-600 text-white rounded-xl font-semibold shadow-lg">
                                    <i class="fas fa-save mr-2 icon-bounce"></i>
                                    Save Template
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Backup & Restore -->
        <div x-show="activeSection === 'backup-restore'" x-cloak style="display: none;">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-database text-green-600 mr-3"></i>
                Backup & Restore
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Manage system backups and restore data from backups.</p>
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <p class="text-sm text-gray-500 dark:text-gray-400">Backup & Restore settings will be displayed here</p>
                </div>
            </div>
        </div>

        <!-- Language & Timezone -->
        <div x-show="activeSection === 'language-timezone'" x-cloak style="display: none;">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
                <i class="fas fa-globe text-green-600 mr-3"></i>
                Language & Timezone
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mb-6">Configure system language and timezone settings.</p>
            <div class="space-y-4">
                <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                    <p class="text-sm text-gray-500 dark:text-gray-400">Language & Timezone settings will be displayed here</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// School Profile Form - Logo Preview and Case Conversion
document.addEventListener('DOMContentLoaded', function() {
    // Logo preview on file selection
    const logoInput = document.getElementById('school_logo_input');
    const logoPreviewContainer = document.getElementById('logo-preview-container');
    const currentLogo = document.getElementById('current-logo');
    const logoPlaceholder = document.getElementById('logo-placeholder');
    const logoPreviewLabel = document.getElementById('logo-preview-label');
    
    if (logoInput) {
        logoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Validate file type
                if (!file.type.match('image.*')) {
                    alert('Please select an image file.');
                    this.value = '';
                    return;
                }
                
                // Validate file size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB.');
                    this.value = '';
                    return;
                }
                
                // Create preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Remove current logo or placeholder
                    if (currentLogo) {
                        currentLogo.remove();
                    }
                    if (logoPlaceholder) {
                        logoPlaceholder.remove();
                    }
                    
                    // Create new preview image
                    const previewImg = document.createElement('img');
                    previewImg.id = 'logo-preview';
                    previewImg.src = e.target.result;
                    previewImg.alt = 'Logo Preview';
                    previewImg.className = 'w-32 h-32 object-cover rounded-lg border-2 border-gray-200 dark:border-gray-700 shadow-md';
                    
                    // Create label
                    const label = document.createElement('p');
                    label.className = 'text-xs text-gray-500 dark:text-gray-400 mt-2 text-center';
                    label.textContent = 'New Logo Preview';
                    label.id = 'logo-preview-label';
                    
                    // Add to container
                    logoPreviewContainer.innerHTML = '';
                    logoPreviewContainer.appendChild(previewImg);
                    logoPreviewContainer.appendChild(label);
                };
                reader.readAsDataURL(file);
            } else {
                // Reset to original if no file selected
                if (currentLogo) {
                    logoPreviewContainer.innerHTML = '';
                    logoPreviewContainer.appendChild(currentLogo);
                    const label = document.createElement('p');
                    label.className = 'text-xs text-gray-500 dark:text-gray-400 mt-2 text-center';
                    label.textContent = 'Current Logo';
                    logoPreviewContainer.appendChild(label);
                } else if (logoPlaceholder) {
                    logoPreviewContainer.innerHTML = '';
                    logoPreviewContainer.appendChild(logoPlaceholder);
                }
            }
        });
    }
    
    // Convert text fields to UPPERCASE (except email and social media links)
    const uppercaseFields = document.querySelectorAll('.school-profile-uppercase');
    uppercaseFields.forEach(field => {
        field.addEventListener('input', function() {
            const cursorPosition = this.selectionStart;
            this.value = this.value.toUpperCase();
            this.setSelectionRange(cursorPosition, cursorPosition);
        });
        field.addEventListener('blur', function() {
            this.value = this.value.toUpperCase();
        });
    });
    
    // Convert email to lowercase
    const emailField = document.getElementById('school_email');
    if (emailField) {
        emailField.addEventListener('input', function() {
            const cursorPosition = this.selectionStart;
            this.value = this.value.toLowerCase();
            this.setSelectionRange(cursorPosition, cursorPosition);
        });
        emailField.addEventListener('blur', function() {
            this.value = this.value.toLowerCase();
        });
    }
    
    // Social media links - keep as is (no case conversion)
    // They are already set to type="url" which is fine

    // Academic Level Form - Uppercase conversion with proper spacing
    const academicLevelFields = document.querySelectorAll('.academic-level-uppercase');
    academicLevelFields.forEach(field => {
        field.addEventListener('input', function(e) {
            const cursorPosition = this.selectionStart;
            const originalValue = this.value;
            
            // Convert to uppercase
            let value = originalValue.toUpperCase();
            
            // Replace multiple consecutive spaces with a single space, but preserve single spaces
            // This regex replaces 2+ spaces with 1 space, keeping single spaces intact
            value = value.replace(/  +/g, ' ');
            
            // Only update if value changed to avoid cursor jumping
            if (value !== originalValue) {
                this.value = value;
                // Adjust cursor position - if we removed spaces, move cursor back
                const spacesRemoved = (originalValue.length - value.length);
                const newCursorPosition = Math.max(0, cursorPosition - spacesRemoved);
                this.setSelectionRange(newCursorPosition, newCursorPosition);
            }
        });
        
        field.addEventListener('blur', function() {
            // Final cleanup on blur - trim leading/trailing spaces but keep single spaces
            let value = this.value.toUpperCase();
            // Replace multiple spaces with single space
            value = value.replace(/  +/g, ' ');
            // Trim only leading and trailing spaces, not internal single spaces
            value = value.trim();
            this.value = value;
        });
    });

    // Academic Level Status Toggle
    const levelStatusToggle = document.getElementById('level_status');
    const levelStatusValue = document.getElementById('level_status_value');
    const statusLabel = document.getElementById('status-label');
    
    if (levelStatusToggle && statusLabel && levelStatusValue) {
        levelStatusToggle.addEventListener('change', function() {
            if (this.checked) {
                statusLabel.textContent = 'Active';
                statusLabel.className = 'text-sm font-medium text-green-600 dark:text-green-400';
                levelStatusValue.value = 'active';
            } else {
                statusLabel.textContent = 'Inactive';
                statusLabel.className = 'text-sm font-medium text-gray-600 dark:text-gray-400';
                levelStatusValue.value = 'inactive';
            }
        });
        
        // Set initial label state
        if (levelStatusToggle.checked) {
            statusLabel.textContent = 'Active';
            statusLabel.className = 'text-sm font-medium text-green-600 dark:text-green-400';
            levelStatusValue.value = 'active';
        } else {
            statusLabel.textContent = 'Inactive';
            statusLabel.className = 'text-sm font-medium text-gray-600 dark:text-gray-400';
            levelStatusValue.value = 'inactive';
        }
    }

    // Academic Level Status Toggle in Table
    const statusToggles = document.querySelectorAll('.status-toggle');
    statusToggles.forEach(toggle => {
        toggle.addEventListener('change', function() {
            const levelId = this.getAttribute('data-level-id');
            const statusLabel = document.getElementById(`status-label-${levelId}`);
            const isChecked = this.checked;
            
            // Disable toggle during request
            this.disabled = true;
            
            // Show loading state
            if (statusLabel) {
                statusLabel.textContent = 'Updating...';
                statusLabel.className = 'text-xs font-medium text-blue-600 dark:text-blue-400';
            }
            
            // Make AJAX request
            fetch(`/system-settings/academic-level/${levelId}/toggle-status`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update label
                    if (statusLabel) {
                        if (data.new_status === 'active') {
                            statusLabel.textContent = 'Active';
                            statusLabel.className = 'text-xs font-medium text-green-600 dark:text-green-400';
                        } else {
                            statusLabel.textContent = 'Inactive';
                            statusLabel.className = 'text-xs font-medium text-gray-500 dark:text-gray-400';
                        }
                    }
                    
                    // Show success message (optional - you can use flash messages instead)
                    console.log('Status updated successfully');
                } else {
                    // Revert toggle state on error
                    this.checked = !isChecked;
                    alert(data.message || 'Failed to update status. Please try again.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Revert toggle state on error
                this.checked = !isChecked;
                alert('An error occurred while updating the status. Please try again.');
            })
            .finally(() => {
                // Re-enable toggle
                this.disabled = false;
            });
        });
    });

    // Edit Academic Level Modal
    const editButtons = document.querySelectorAll('.edit-level-btn');
    const editModal = document.getElementById('editLevelModal');
    const editForm = document.getElementById('editLevelForm');
    
    editButtons.forEach(button => {
        button.addEventListener('click', function() {
            const levelId = this.getAttribute('data-level-id');
            const levelCategory = this.getAttribute('data-level-category');
            const levelName = this.getAttribute('data-level-name');
            const levelDescription = this.getAttribute('data-level-description');
            const levelStatus = this.getAttribute('data-level-status');
            
            // Populate form
            document.getElementById('edit_level_id').value = levelId;
            document.getElementById('edit_level_category').value = levelCategory;
            document.getElementById('edit_level_name').value = levelName;
            document.getElementById('edit_level_description').value = levelDescription || '';
            
            // Set status toggle
            const statusToggle = document.getElementById('edit_level_status');
            const statusValue = document.getElementById('edit_level_status_value');
            const statusLabel = document.getElementById('edit_status_label');
            
            if (levelStatus === 'active') {
                statusToggle.checked = true;
                statusValue.value = 'active';
                statusLabel.textContent = 'Active';
                statusLabel.className = 'text-sm font-medium text-green-600 dark:text-green-400';
            } else {
                statusToggle.checked = false;
                statusValue.value = 'inactive';
                statusLabel.textContent = 'Inactive';
                statusLabel.className = 'text-sm font-medium text-gray-600 dark:text-gray-400';
            }
            
            // Show modal
            editModal.classList.remove('hidden');
            editModal.style.display = 'flex';
        });
    });

    // Edit form status toggle
    const editStatusToggle = document.getElementById('edit_level_status');
    const editStatusValue = document.getElementById('edit_level_status_value');
    const editStatusLabel = document.getElementById('edit_status_label');
    
    if (editStatusToggle && editStatusValue && editStatusLabel) {
        editStatusToggle.addEventListener('change', function() {
            if (this.checked) {
                editStatusLabel.textContent = 'Active';
                editStatusLabel.className = 'text-sm font-medium text-green-600 dark:text-green-400';
                editStatusValue.value = 'active';
            } else {
                editStatusLabel.textContent = 'Inactive';
                editStatusLabel.className = 'text-sm font-medium text-gray-600 dark:text-gray-400';
                editStatusValue.value = 'inactive';
            }
        });
    }

    // Handle edit form submission
    if (editForm) {
        editForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const levelId = formData.get('level_id');
            const updateData = {
                level_category: formData.get('level_category').trim().toUpperCase(),
                level_name: formData.get('level_name').trim().toUpperCase(),
                level_description: formData.get('level_description').trim().toUpperCase(),
                level_status: formData.get('level_status_value')
            };
            
            // Disable submit button
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';
            
            fetch(`/system-settings/academic-level/${levelId}/update`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updateData),
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal
                    editModal.classList.add('hidden');
                    editModal.style.display = 'none';
                    
                    // Reload page to show updated data
                    window.location.reload();
                } else {
                    alert(data.message || 'Failed to update academic level. Please try again.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while updating the academic level. Please try again.');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            });
        });
    }

    // Delete Academic Level
    const deleteButtons = document.querySelectorAll('.delete-level-btn');
    
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const levelId = this.getAttribute('data-level-id');
            const levelName = this.getAttribute('data-level-name');
            
            // Show confirmation dialog
            if (confirm(`Are you sure you want to delete "${levelName}"?\n\nThis action cannot be undone.`)) {
                // Disable button during deletion
                this.disabled = true;
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                fetch(`/system-settings/academic-level/${levelId}/delete`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Remove row from table
                        const row = this.closest('tr');
                        row.style.transition = 'opacity 0.3s';
                        row.style.opacity = '0';
                        setTimeout(() => {
                            row.remove();
                            // Check if table is empty
                            const tbody = document.querySelector('.bg-white.dark\\:bg-gray-800 tbody');
                            if (tbody && tbody.children.length === 0) {
                                tbody.innerHTML = `
                                    <tr>
                                        <td colspan="5" class="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                                            <i class="fas fa-inbox text-4xl mb-3 opacity-50"></i>
                                            <p>No academic levels registered yet</p>
                                        </td>
                                    </tr>
                                `;
                            }
                        }, 300);
                    } else {
                        alert(data.message || 'Failed to delete academic level. Please try again.');
                        this.disabled = false;
                        this.innerHTML = originalHTML;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the academic level. Please try again.');
                    this.disabled = false;
                    this.innerHTML = originalHTML;
                });
            }
        });
    });

    // Close modal when clicking outside
    if (editModal) {
        editModal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
                this.style.display = 'none';
            }
        });
    }

    // Academic Year Delete
    const deleteYearButtons = document.querySelectorAll('.delete-year-btn');
    deleteYearButtons.forEach(button => {
        button.addEventListener('click', function() {
            const yearId = this.getAttribute('data-year-id');
            const yearName = this.getAttribute('data-year-name');
            
            if (confirm(`Are you sure you want to delete "${yearName}"?\n\nThis action cannot be undone if the academic year has no financial records.`)) {
                this.disabled = true;
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                fetch(`/system-settings/academic-year/${yearId}/delete`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert(data.message || 'Failed to delete academic year.');
                        this.disabled = false;
                        this.innerHTML = originalHTML;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the academic year.');
                    this.disabled = false;
                    this.innerHTML = originalHTML;
                });
            }
        });
    });

    // Term Delete
    const deleteTermButtons = document.querySelectorAll('.delete-term-btn');
    deleteTermButtons.forEach(button => {
        button.addEventListener('click', function() {
            const termId = this.getAttribute('data-term-id');
            const termName = this.getAttribute('data-term-name');
            
            if (confirm(`Are you sure you want to delete "${termName}"?\n\nThis action cannot be undone if the term has no fee structures.`)) {
                this.disabled = true;
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                fetch(`/system-settings/term/${termId}/delete`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert(data.message || 'Failed to delete term.');
                        this.disabled = false;
                        this.innerHTML = originalHTML;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while deleting the term.');
                    this.disabled = false;
                    this.innerHTML = originalHTML;
                });
            }
        });
    });

    // Academic Year Edit Modal
    const editYearButtons = document.querySelectorAll('.edit-year-btn');
    const editYearModal = document.getElementById('editYearModal');
    const editYearForm = document.getElementById('editYearForm');
    
    editYearButtons.forEach(button => {
        button.addEventListener('click', function() {
            const yearId = this.getAttribute('data-year-id');
            const yearName = this.getAttribute('data-year-name');
            const startDate = this.getAttribute('data-start-date');
            const endDate = this.getAttribute('data-end-date');
            const status = this.getAttribute('data-status');
            const isCurrent = this.getAttribute('data-is-current') === 'true';
            
            // Populate form
            document.getElementById('edit_year_id').value = yearId;
            document.getElementById('edit_year_name').value = yearName || '';
            document.getElementById('edit_year_start_date').value = startDate || '';
            document.getElementById('edit_year_end_date').value = endDate || '';
            document.getElementById('edit_year_status').value = status || 'draft';
            document.getElementById('edit_year_is_current').checked = isCurrent;
            
            // Show modal
            editYearModal.classList.remove('hidden');
            editYearModal.style.display = 'flex';
        });
    });
    
    // Function to close edit year modal
    function closeEditYearModal() {
        if (editYearModal) {
            editYearModal.classList.add('hidden');
            editYearModal.style.display = 'none';
            // Reset form if needed
            if (editYearForm) {
                editYearForm.reset();
            }
        }
    }
    
    // Close edit year modal when clicking outside
    if (editYearModal) {
        editYearModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditYearModal();
            }
        });
    }
    
    // Close button handlers
    const closeEditYearModalBtns = document.querySelectorAll('.close-edit-year-modal');
    closeEditYearModalBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            closeEditYearModal();
        });
    });
    
    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && editYearModal && !editYearModal.classList.contains('hidden')) {
            closeEditYearModal();
        }
    });
    
    // Handle edit year form submission
    if (editYearForm) {
        editYearForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const yearId = formData.get('year_id');
            
            const updateData = {
                year_name: formData.get('year_name').trim().toUpperCase(),
                start_date: formData.get('start_date'),
                end_date: formData.get('end_date'),
                status: formData.get('status'),
                is_current: formData.get('is_current') === 'on'
            };
            
            // Disable submit button
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2 loading-spinner"></i>Updating...';
            
            fetch(`/system-settings/academic-year/${yearId}/update`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updateData),
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-slideIn';
                    successMsg.innerHTML = '<i class="fas fa-check-circle"></i> Academic year updated successfully!';
                    document.body.appendChild(successMsg);
                    
                    // Close modal
                    closeEditYearModal();
                    
                    // Remove success message after 3 seconds
                    setTimeout(() => {
                        successMsg.remove();
                    }, 3000);
                    
                    // Reload page to show updated data
                    setTimeout(() => {
                        window.location.reload();
                    }, 500);
                } else {
                    // Show error message
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-slideIn';
                    errorMsg.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${data.message || 'Failed to update academic year. Please try again.'}`;
                    document.body.appendChild(errorMsg);
                    
                    // Remove error message after 5 seconds
                    setTimeout(() => {
                        errorMsg.remove();
                    }, 5000);
                    
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                
                // Show error message
                const errorMsg = document.createElement('div');
                errorMsg.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-slideIn';
                errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> An error occurred while updating the academic year. Please try again.';
                document.body.appendChild(errorMsg);
                
                // Remove error message after 5 seconds
                setTimeout(() => {
                    errorMsg.remove();
                }, 5000);
                
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            });
        });
    }
    
    // SMS Character Counter for Notification Templates
    function setupSmsCounter(textareaId, countId) {
        const textarea = document.getElementById(textareaId);
        const count = document.getElementById(countId);
        if (textarea && count) {
            textarea.addEventListener('input', function() {
                const length = this.value.length;
                count.textContent = `${length}/160`;
                if (length > 160) {
                    count.classList.add('text-red-500');
                    count.classList.remove('text-gray-500');
                } else {
                    count.classList.remove('text-red-500');
                    count.classList.add('text-gray-500');
                }
            });
            // Initialize count
            if (textarea.value) {
                count.textContent = `${textarea.value.length}/160`;
            }
        }
    }
    
    // Setup all SMS counters
    setupSmsCounter('academic_year_opening_sms_template', 'academic_year_opening_sms_count');
    setupSmsCounter('academic_year_closing_sms_template', 'academic_year_closing_sms_count');
    setupSmsCounter('term_opening_sms_template', 'term_opening_sms_count');
    setupSmsCounter('term_closing_sms_template', 'term_closing_sms_count');
    
    // Year name uppercase conversion for edit modal
    const editYearNameInput = document.getElementById('edit_year_name');
    if (editYearNameInput) {
        editYearNameInput.addEventListener('input', function() {
            const cursorPosition = this.selectionStart;
            this.value = this.value.toUpperCase();
            this.setSelectionRange(cursorPosition, cursorPosition);
        });
        editYearNameInput.addEventListener('blur', function() {
            this.value = this.value.toUpperCase();
        });
    }

    // Term Edit Modal
    const editTermButtons = document.querySelectorAll('.edit-term-btn');
    const editTermModal = document.getElementById('editTermModal');
    const editTermForm = document.getElementById('editTermForm');
    
    editTermButtons.forEach(button => {
        button.addEventListener('click', function() {
            const termId = this.getAttribute('data-term-id');
            const termName = this.getAttribute('data-term-name');
            const academicYearId = this.getAttribute('data-academic-year-id');
            const academicLevelIds = this.getAttribute('data-academic-level-ids') || '';
            const startDate = this.getAttribute('data-start-date');
            const endDate = this.getAttribute('data-end-date');
            const status = this.getAttribute('data-status');
            const isCurrent = this.getAttribute('data-is-current') === 'true';
            
            // Populate form
            document.getElementById('edit_term_id').value = termId;
            document.getElementById('edit_term_name').value = termName || '';
            document.getElementById('edit_term_academic_year_id').value = academicYearId || '';
            document.getElementById('edit_term_start_date').value = startDate || '';
            document.getElementById('edit_term_end_date').value = endDate || '';
            document.getElementById('edit_term_status').value = status || 'draft';
            document.getElementById('edit_term_is_current').checked = isCurrent;
            document.getElementById('edit_term_is_current_label').textContent = isCurrent ? 'Yes' : 'No';
            
            // Set academic levels (checkboxes)
            // Clear all checkboxes first
            const checkboxes = document.querySelectorAll('#edit_term_academic_levels_container input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                const label = checkbox.closest('.academic-level-label');
                if (label) {
                    label.classList.remove('checked-label');
                }
            });
            
            // Check the appropriate checkboxes if academic levels are linked
            if (academicLevelIds && academicLevelIds.trim() !== '') {
                const levelIdsArray = academicLevelIds.split(',').filter(id => id.trim());
                
                levelIdsArray.forEach(levelId => {
                    const trimmedId = levelId.trim();
                    // Find checkbox by value
                    const checkbox = document.querySelector(`#edit_term_academic_levels_container input[type="checkbox"][value="${trimmedId}"]`);
                    if (checkbox) {
                        checkbox.checked = true;
                        // Apply styling immediately
                        const label = checkbox.closest('.academic-level-label');
                        if (label) {
                            label.classList.add('checked-label');
                        }
                    }
                });
            }
            
            // Update date picker limits based on selected academic year
            updateEditTermDateLimits();
            
            // Show modal
            editTermModal.classList.remove('hidden');
            editTermModal.style.display = 'flex';
        });
    });
    
    // Update date picker limits for edit term modal
    function updateEditTermDateLimits() {
        const academicYearSelect = document.getElementById('edit_term_academic_year_id');
        const startDateInput = document.getElementById('edit_term_start_date');
        const endDateInput = document.getElementById('edit_term_end_date');
        const startDateHint = document.getElementById('edit_term_start_date_hint');
        const endDateHint = document.getElementById('edit_term_end_date_hint');
        
        const selectedYearId = academicYearSelect ? academicYearSelect.value : null;
        
        if (!selectedYearId || !academicYearDates[selectedYearId]) {
            if (startDateInput) {
                startDateInput.removeAttribute('min');
                startDateInput.removeAttribute('max');
            }
            if (endDateInput) {
                endDateInput.removeAttribute('min');
                endDateInput.removeAttribute('max');
            }
            if (startDateHint) startDateHint.classList.add('hidden');
            if (endDateHint) endDateHint.classList.add('hidden');
            return;
        }
        
        const yearDates = academicYearDates[selectedYearId];
        
        if (startDateInput && yearDates.start && yearDates.end) {
            startDateInput.setAttribute('min', yearDates.start);
            startDateInput.setAttribute('max', yearDates.end);
            if (startDateHint) {
                startDateHint.innerHTML = `<i class="fas fa-info-circle"></i> Available range: ${formatDate(yearDates.start)} to ${formatDate(yearDates.end)}`;
                startDateHint.classList.remove('hidden');
            }
        }
        
        if (endDateInput && yearDates.start && yearDates.end) {
            endDateInput.setAttribute('min', yearDates.start);
            endDateInput.setAttribute('max', yearDates.end);
            if (endDateHint) {
                endDateHint.innerHTML = `<i class="fas fa-info-circle"></i> Available range: ${formatDate(yearDates.start)} to ${formatDate(yearDates.end)}`;
                endDateHint.classList.remove('hidden');
            }
        }
    }
    
    // Listen for academic year change in edit modal
    const editTermAcademicYearSelect = document.getElementById('edit_term_academic_year_id');
    if (editTermAcademicYearSelect) {
        editTermAcademicYearSelect.addEventListener('change', function() {
            updateEditTermDateLimits();
            // Clear dates if they're outside the new range
            const startDateInput = document.getElementById('edit_term_start_date');
            const endDateInput = document.getElementById('edit_term_end_date');
            const selectedYearId = this.value;
            
            if (selectedYearId && academicYearDates[selectedYearId]) {
                const yearDates = academicYearDates[selectedYearId];
                if (startDateInput && startDateInput.value) {
                    if (startDateInput.value < yearDates.start || startDateInput.value > yearDates.end) {
                        startDateInput.value = '';
                    }
                }
                if (endDateInput && endDateInput.value) {
                    if (endDateInput.value < yearDates.start || endDateInput.value > yearDates.end) {
                        endDateInput.value = '';
                    }
                }
            }
        });
    }
    
    // Handle edit term form submission
    if (editTermForm) {
        editTermForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const termId = formData.get('term_id');
            
            // Get checked academic level IDs from checkboxes
            const checkedBoxes = document.querySelectorAll('#edit_term_academic_levels_container input[type="checkbox"]:checked');
            const selectedLevels = Array.from(checkedBoxes).map(checkbox => checkbox.value);
            
            const updateData = {
                term_name: formData.get('term_name').trim().toUpperCase(),
                academic_year_id: formData.get('academic_year_id'),
                academic_level_ids: selectedLevels,
                start_date: formData.get('start_date'),
                end_date: formData.get('end_date'),
                status: formData.get('status'),
                is_current: document.getElementById('edit_term_is_current').checked
            };
            
            // Disable submit button
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2 loading-spinner"></i>Updating...';
            
            fetch(`/system-settings/term/${termId}/update`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updateData),
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-slideIn';
                    successMsg.innerHTML = '<i class="fas fa-check-circle"></i> Term updated successfully!';
                    document.body.appendChild(successMsg);
                    
                    // Close modal
                    closeEditTermModal();
                    
                    // Remove success message after 3 seconds
                    setTimeout(() => {
                        successMsg.remove();
                    }, 3000);
                    
                    // Reload page to show updated data
                    setTimeout(() => {
                        window.location.reload();
                    }, 500);
                } else {
                    // Show error message
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-slideIn';
                    errorMsg.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${data.message || 'Failed to update term. Please try again.'}`;
                    document.body.appendChild(errorMsg);
                    
                    // Remove error message after 5 seconds
                    setTimeout(() => {
                        errorMsg.remove();
                    }, 5000);
                    
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                
                // Show error message
                const errorMsg = document.createElement('div');
                errorMsg.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-slideIn';
                errorMsg.innerHTML = '<i class="fas fa-exclamation-circle"></i> An error occurred while updating the term. Please try again.';
                document.body.appendChild(errorMsg);
                
                // Remove error message after 5 seconds
                setTimeout(() => {
                    errorMsg.remove();
                }, 5000);
                
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            });
        });
    }
    
    // Function to close edit term modal
    function closeEditTermModal() {
        if (editTermModal) {
            editTermModal.classList.add('hidden');
            editTermModal.style.display = 'none';
            // Reset form if needed
            if (editTermForm) {
                editTermForm.reset();
            }
        }
    }
    
    // Close edit term modal when clicking outside
    if (editTermModal) {
        editTermModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditTermModal();
            }
        });
    }
    
    // Close button handlers
    const closeEditTermModalBtns = document.querySelectorAll('.close-edit-term-modal');
    closeEditTermModalBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            closeEditTermModal();
        });
    });
    
    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && editTermModal && !editTermModal.classList.contains('hidden')) {
            closeEditTermModal();
        }
    });
    
    // Term name uppercase conversion for edit modal
    const editTermNameInput = document.getElementById('edit_term_name');
    if (editTermNameInput) {
        editTermNameInput.addEventListener('input', function() {
            const cursorPosition = this.selectionStart;
            this.value = this.value.toUpperCase();
            this.setSelectionRange(cursorPosition, cursorPosition);
        });
        editTermNameInput.addEventListener('blur', function() {
            this.value = this.value.toUpperCase();
        });
    }
    
    // Handle checkbox styling for academic levels (Add Term form)
    const academicLevelCheckboxes = document.querySelectorAll('input[name="academic_level_ids"]');
    academicLevelCheckboxes.forEach(checkbox => {
        // Update label styling on change
        checkbox.addEventListener('change', function() {
            const label = this.closest('.academic-level-label');
            if (this.checked) {
                label.classList.add('checked-label');
            } else {
                label.classList.remove('checked-label');
            }
        });
        
        // Initialize styling if already checked
        const label = checkbox.closest('.academic-level-label');
        if (checkbox.checked && label) {
            label.classList.add('checked-label');
        }
    });
    
    // Handle checkbox styling for academic levels (Edit Term modal)
    // Use event delegation since checkboxes are dynamically rendered
    const editTermAcademicLevelsContainer = document.getElementById('edit_term_academic_levels_container');
    if (editTermAcademicLevelsContainer) {
        editTermAcademicLevelsContainer.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox') {
                const checkbox = e.target;
                const label = checkbox.closest('.academic-level-label');
                if (label) {
                    if (checkbox.checked) {
                        label.classList.add('checked-label');
                    } else {
                        label.classList.remove('checked-label');
                    }
                }
            }
        });
    }

    // Academic Year Suspend/Unsuspend Toggle
    const toggleSuspendYearButtons = document.querySelectorAll('.toggle-suspend-year-btn');
    toggleSuspendYearButtons.forEach(button => {
        button.addEventListener('click', function() {
            const yearId = this.getAttribute('data-year-id');
            const currentStatus = this.getAttribute('data-year-status');
            const action = currentStatus === 'suspended' ? 'unsuspend' : 'suspend';
            
            if (confirm(`Are you sure you want to ${action} this academic year?`)) {
                this.disabled = true;
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                fetch(`/system-settings/academic-year/${yearId}/toggle-suspend`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert(data.message || 'Failed to update academic year status.');
                        this.disabled = false;
                        this.innerHTML = originalHTML;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while updating the academic year status.');
                    this.disabled = false;
                    this.innerHTML = originalHTML;
                });
            }
        });
    });
    
    // Academic Year Lock/Unlock Toggle
    const toggleLockYearButtons = document.querySelectorAll('.toggle-lock-year-btn');
    toggleLockYearButtons.forEach(button => {
        button.addEventListener('click', function() {
            const yearId = this.getAttribute('data-year-id');
            const isLocked = this.getAttribute('data-year-locked') === 'true';
            const action = isLocked ? 'unlock' : 'lock';
            
            if (confirm(`Are you sure you want to ${action} this academic year?`)) {
                this.disabled = true;
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                fetch(`/system-settings/academic-year/${yearId}/toggle-lock`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert(data.message || 'Failed to update academic year lock status.');
                        this.disabled = false;
                        this.innerHTML = originalHTML;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while updating the academic year lock status.');
                    this.disabled = false;
                    this.innerHTML = originalHTML;
                });
            }
        });
    });

    // Term Is Current Toggle
    const toggleCurrentButtons = document.querySelectorAll('.toggle-current-btn');
    toggleCurrentButtons.forEach(button => {
        button.addEventListener('click', function() {
            const termId = this.getAttribute('data-term-id');
            const isCurrent = this.getAttribute('data-term-current') === 'true';
            const action = isCurrent ? 'remove as current' : 'mark as current';
            
            if (confirm(`Are you sure you want to ${action} this term? This will automatically unmark any other current term.`)) {
                this.disabled = true;
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                fetch(`/system-settings/term/${termId}/toggle-current`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert(data.message || 'Failed to update term current status');
                        this.innerHTML = originalHTML;
                        this.disabled = false;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                    this.innerHTML = originalHTML;
                    this.disabled = false;
                });
            }
        });
    });
    
    // Term Suspend/Unsuspend Toggle
    const toggleSuspendButtons = document.querySelectorAll('.toggle-suspend-btn');
    toggleSuspendButtons.forEach(button => {
        button.addEventListener('click', function() {
            const termId = this.getAttribute('data-term-id');
            const currentStatus = this.getAttribute('data-term-status');
            const action = currentStatus === 'suspended' ? 'unsuspend' : 'suspend';
            
            if (confirm(`Are you sure you want to ${action} this term?`)) {
                this.disabled = true;
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                fetch(`/system-settings/term/${termId}/toggle-suspend`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert(data.message || 'Failed to update term status.');
                        this.disabled = false;
                        this.innerHTML = originalHTML;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while updating the term status.');
                    this.disabled = false;
                    this.innerHTML = originalHTML;
                });
            }
        });
    });

    // Term Lock/Unlock Toggle
    const toggleLockButtons = document.querySelectorAll('.toggle-lock-btn');
    toggleLockButtons.forEach(button => {
        button.addEventListener('click', function() {
            const termId = this.getAttribute('data-term-id');
            const isLocked = this.getAttribute('data-term-locked') === 'true';
            const action = isLocked ? 'unlock' : 'lock';
            
            if (confirm(`Are you sure you want to ${action} this term?`)) {
                this.disabled = true;
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                fetch(`/system-settings/term/${termId}/toggle-lock`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.reload();
                    } else {
                        alert(data.message || 'Failed to update term lock status.');
                        this.disabled = false;
                        this.innerHTML = originalHTML;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while updating the term lock status.');
                    this.disabled = false;
                    this.innerHTML = originalHTML;
                });
            }
        });
    });

    // Academic Year Form - Uppercase conversion
    const yearNameInput = document.getElementById('year_name');
    if (yearNameInput) {
        yearNameInput.addEventListener('input', function() {
            const cursorPosition = this.selectionStart;
            this.value = this.value.toUpperCase();
            this.setSelectionRange(cursorPosition, cursorPosition);
        });
        yearNameInput.addEventListener('blur', function() {
            this.value = this.value.toUpperCase();
        });
    }

    // Term Form - Uppercase conversion
    const termNameInput = document.getElementById('term_name');
    if (termNameInput) {
        termNameInput.addEventListener('input', function() {
            const cursorPosition = this.selectionStart;
            this.value = this.value.toUpperCase();
            this.setSelectionRange(cursorPosition, cursorPosition);
        });
        termNameInput.addEventListener('blur', function() {
            this.value = this.value.toUpperCase();
        });
    }

    // Term Date Validation - Ensure dates are within academic year range
    const academicYearSelect = document.getElementById('academic_year_id');
    const termStartDate = document.getElementById('term_start_date');
    const termEndDate = document.getElementById('term_end_date');
    
    // Store academic year dates
    const academicYearDates = {};
    {% if academic_years %}
        {% for year in academic_years %}
        academicYearDates[{{ year.id }}] = {
            start: '{{ year.start_date.strftime("%Y-%m-%d") if year.start_date else "" }}',
            end: '{{ year.end_date.strftime("%Y-%m-%d") if year.end_date else "" }}',
            yearName: '{{ year.year_name }}'
        };
        {% endfor %}
    {% endif %}
    
    function updateDatePickerLimits() {
        const selectedYearId = academicYearSelect ? academicYearSelect.value : null;
        const startDateHint = document.getElementById('term_start_date_hint');
        const endDateHint = document.getElementById('term_end_date_hint');
        
        if (!selectedYearId || !academicYearDates[selectedYearId]) {
            // Clear min/max if no academic year selected
            if (termStartDate) {
                termStartDate.removeAttribute('min');
                termStartDate.removeAttribute('max');
                termStartDate.value = '';
            }
            if (termEndDate) {
                termEndDate.removeAttribute('min');
                termEndDate.removeAttribute('max');
                termEndDate.value = '';
            }
            if (startDateHint) startDateHint.classList.add('hidden');
            if (endDateHint) endDateHint.classList.add('hidden');
            return;
        }
        
        const yearDates = academicYearDates[selectedYearId];
        
        // Update min/max attributes to restrict calendar selection
        if (termStartDate && yearDates.start && yearDates.end) {
            termStartDate.setAttribute('min', yearDates.start);
            termStartDate.setAttribute('max', yearDates.end);
            // Clear any invalid date if it's outside the range
            if (termStartDate.value && (termStartDate.value < yearDates.start || termStartDate.value > yearDates.end)) {
                termStartDate.value = '';
            }
            // Show hint with date range
            if (startDateHint) {
                startDateHint.innerHTML = `<i class="fas fa-info-circle"></i> Available range: ${formatDate(yearDates.start)} to ${formatDate(yearDates.end)}`;
                startDateHint.classList.remove('hidden');
            }
        }
        
        if (termEndDate && yearDates.start && yearDates.end) {
            termEndDate.setAttribute('min', yearDates.start);
            termEndDate.setAttribute('max', yearDates.end);
            // Clear any invalid date if it's outside the range
            if (termEndDate.value && (termEndDate.value < yearDates.start || termEndDate.value > yearDates.end)) {
                termEndDate.value = '';
            }
            // Show hint with date range
            if (endDateHint) {
                endDateHint.innerHTML = `<i class="fas fa-info-circle"></i> Available range: ${formatDate(yearDates.start)} to ${formatDate(yearDates.end)}`;
                endDateHint.classList.remove('hidden');
            }
        }
    }
    
    // Helper function to format date for display
    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString + 'T00:00:00');
        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }
    
    function validateTermDates() {
        const selectedYearId = academicYearSelect ? academicYearSelect.value : null;
        const startDate = termStartDate ? termStartDate.value : '';
        const endDate = termEndDate ? termEndDate.value : '';
        
        if (!selectedYearId || !academicYearDates[selectedYearId]) {
            return;
        }
        
        const yearDates = academicYearDates[selectedYearId];
        
        // Validate start date
        if (termStartDate && startDate) {
            if (startDate < yearDates.start) {
                termStartDate.setCustomValidity(`Start date must be on or after ${yearDates.start}`);
                termStartDate.classList.add('border-red-500');
            } else if (startDate > yearDates.end) {
                termStartDate.setCustomValidity(`Start date must be on or before ${yearDates.end}`);
                termStartDate.classList.add('border-red-500');
            } else {
                termStartDate.setCustomValidity('');
                termStartDate.classList.remove('border-red-500');
            }
        }
        
        // Validate end date
        if (termEndDate && endDate) {
            if (endDate < yearDates.start) {
                termEndDate.setCustomValidity(`End date must be on or after ${yearDates.start}`);
                termEndDate.classList.add('border-red-500');
            } else if (endDate > yearDates.end) {
                termEndDate.setCustomValidity(`End date must be on or before ${yearDates.end}`);
                termEndDate.classList.add('border-red-500');
            } else {
                termEndDate.setCustomValidity('');
                termEndDate.classList.remove('border-red-500');
            }
        }
        
        // Validate start date is before end date
        if (termStartDate && termEndDate && startDate && endDate) {
            if (startDate > endDate) {
                termEndDate.setCustomValidity('End date must be on or after start date');
                termEndDate.classList.add('border-red-500');
            } else if (termEndDate.validationMessage === '') {
                termEndDate.classList.remove('border-red-500');
            }
        }
        
        // Update end date min to be at least the start date
        if (termEndDate && termStartDate && startDate) {
            const yearDates = academicYearDates[selectedYearId];
            const minEndDate = startDate > yearDates.start ? startDate : yearDates.start;
            termEndDate.setAttribute('min', minEndDate);
        }
    }
    
    // Update date picker limits when academic year changes
    if (academicYearSelect) {
        academicYearSelect.addEventListener('change', function() {
            updateDatePickerLimits();
            validateTermDates();
        });
    }
    
    // Validate dates when they change
    if (termStartDate) {
        termStartDate.addEventListener('change', function() {
            validateTermDates();
            // Update end date min when start date changes
            if (termEndDate && this.value) {
                const selectedYearId = academicYearSelect ? academicYearSelect.value : null;
                if (selectedYearId && academicYearDates[selectedYearId]) {
                    const yearDates = academicYearDates[selectedYearId];
                    const minEndDate = this.value > yearDates.start ? this.value : yearDates.start;
                    termEndDate.setAttribute('min', minEndDate);
                }
            }
        });
    }
    
    if (termEndDate) {
        termEndDate.addEventListener('change', validateTermDates);
    }
    
    // Initialize date picker limits on page load if academic year is already selected
    if (academicYearSelect && academicYearSelect.value) {
        updateDatePickerLimits();
    }
});
</script>

{% endblock %}

